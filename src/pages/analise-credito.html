<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="author" content="Expertzy Intelig√™ncia Tribut√°ria">
    <meta name="description" content="CreditScore Pro - Sistema de An√°lise de Cr√©dito e Compliance Financeiro">
    <title>CreditScore Pro | Expertzy Intelig√™ncia Tribut√°ria</title>
    
    <!-- Tailwind CSS (deve vir primeiro) -->
    <link rel="stylesheet" href="../assets/css/tailwind.css">

    <!-- Estilos Base -->
    <link rel="stylesheet" href="../assets/css/styles-base.css">
    <link rel="stylesheet" href="../assets/css/tabs.css">
    
    <!-- Favicon -->
    <link rel="icon" type="image/png" href="../assets/images/expertzy_logo.png">
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@100;300;400;500;600;700;800;900&display=swap" rel="stylesheet">
</head>
<body>
    <!-- Header Expertzy -->
    <header class="header">
        <div class="container">
            <div class="header-content">
                <div class="logo">
                    <img src="../assets/images/logo-expertzy-branco.png" alt="Expertzy" class="logo-image">
                </div>
                
                <div class="header-title">
                    <h1 class="form-title" id="systemTitle">CreditScore Pro</h1>
                    <p class="form-subtitle" id="systemSubtitle">Sistema de An√°lise de Cr√©dito e Compliance Financeiro</p>
                </div>
                
                <div class="header-actions">
                    <button type="button" class="btn btn-secondary" id="importBtnHeader">
                        üì§ Importar
                    </button>
                    <input type="file" id="importJsonFileHeader" accept=".json" style="display: none;">
                    
                    <button type="button" class="btn btn-secondary" id="exportJsonBtn">
                        üíæ Exportar JSON
                    </button>
                    
                    <button type="button" class="btn btn-secondary" id="exportExcelBtn">
                        üìä Excel
                    </button>
                    
                    <button type="button" class="btn btn-secondary" id="exportPDFBtn">
                        üìÑ PDF
                    </button>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="progress-container" id="progressContainer">
        <div class="progress-bar">
            <div class="progress-fill" id="progressFill"></div>
        </div>
        <div class="progress-info">
            <span class="progress-text" id="progressText">Carregando...</span>
            <span class="progress-percentage" id="progressPercentage">0%</span>
        </div>
    </div>

    <!-- Tab Navigation -->
    <nav class="tab-navigation" id="tabNavigation">
        <!-- Tabs ser√£o geradas dinamicamente pelo JavaScript -->
    </nav>

    <!-- Main Content -->
    <main class="main">
        <div class="container">
            <form id="creditScoreForm" class="form-container" novalidate>
                <!-- Loading State -->
                <div class="loading-state" id="loadingState">
                    <div class="loading"></div>
                    <p>Carregando configura√ß√µes do sistema...</p>
                </div>

                <!-- Form Content ser√° gerado dinamicamente -->
                <div class="form-content" id="formContent" style="display: none;">
                    <!-- Tab Contents ser√£o injetados aqui -->
                </div>

                <!-- Form Actions -->
                <div class="form-actions" id="formActions" style="display: none;">
                    <div class="action-buttons">
                        <button type="button" class="btn btn-secondary" id="prevBtn" disabled>
                            ‚Üê Anterior
                        </button>
                        
                        <button type="button" class="btn btn-secondary" id="saveBtn">
                            üíæ Salvar Rascunho
                        </button>
                        
                        <button type="button" class="btn btn-primary" id="nextBtn">
                            Pr√≥ximo ‚Üí
                        </button>
                        
                        <button type="button" class="btn btn-success" id="finishBtn" style="display: none;">
                            ‚úì Finalizar An√°lise
                        </button>
                    </div>
                </div>
            </form>
        </div>
    </main>

    <!-- Alert Container -->
    <div class="alert-container" id="alertContainer"></div>

    <!-- Modal Container -->
    <div class="modal" id="modalContainer">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="modalTitle">T√≠tulo</h3>
                <button class="modal-close" id="modalClose">√ó</button>
            </div>
            <div class="modal-body" id="modalBody">
                <!-- Conte√∫do din√¢mico -->
            </div>
            <div class="modal-footer" id="modalFooter">
                <button class="btn btn-secondary" id="modalCancel">Cancelar</button>
                <button class="btn btn-primary" id="modalConfirm">Confirmar</button>
            </div>
        </div>
    </div>

    <!-- Save Status -->
    <div class="save-status" id="saveStatus">
        <span id="saveStatusText">üíæ Salvo</span>
    </div>

    <!-- Scripts Core -->
    <script type="module" src="../assets/js/utils/currency-mask.js"></script>
    <script type="module" src="../assets/js/utils/cnpj-validator.js"></script>
    <script type="module" src="../assets/js/utils/percentage-calculator.js"></script>

    <!-- UI Components -->
    <script type="module" src="../assets/js/components/ui-components.js"></script>

    <!-- Config Loader (deve vir antes do schema) -->
    <script type="module" src="../assets/js/core/config-loader.js"></script>

    <!-- Database Schema -->
    <script type="module" src="../assets/js/database/creditscore-indexeddb-schema.js"></script>
    <script type="module" src="../shared/validation.js"></script>
    <script type="module" src="../assets/js/export.js"></script>
    <script type="module" src="../assets/js/import.js"></script>
    <script type="module" src="../assets/js/tabs.js"></script>
    
    <!-- Scripts Calculators -->
    <script type="module" src="../assets/js/calculators/indices-financeiros.js"></script>
    <script type="module" src="../assets/js/calculators/scoring-engine.js"></script>
    <script type="module" src="../assets/js/calculators/analise-vertical-horizontal.js"></script>
    <script type="module" src="../assets/js/calculators/capital-giro.js"></script>
    
    <!-- Scripts Core CreditScore -->
    <script type="module" src="../assets/js/core/creditscore-module.js"></script>
    <script type="module" src="../assets/js/core/form-generator.js"></script>
    <script type="module" src="../assets/js/core/navigation-controller.js"></script>
    <script type="module" src="../assets/js/core/auto-save.js"></script>
    
    <!-- Main Application Script -->
    <script type="module">
        /**
         * CREDITSCORE PRO - MAIN APPLICATION
         * Sistema Modular de An√°lise de Cr√©dito
         * 
         * PRINC√çPIOS:
         * - KISS: Arquitetura simples e direta
         * - DRY: Componentes reutiliz√°veis
         * - SOLID: Separa√ß√£o de responsabilidades
         * - NO HARDCODED DATA: Tudo vem da configura√ß√£o
         * - NO MOCK DATA: Apenas dados reais do usu√°rio
         */
        
        class CreditScoreProApp {
            constructor() {
                this.config = null;
                this.messages = null;
                this.modules = new Map();
                this.currentModule = 1;
                this.formData = new Map();
                this.initialized = false;
                this.hierarchicalNav = null;
                this.dbManager = null;

                console.log('üöÄ CreditScore Pro App iniciando...');
            }
            
            /**
             * Inicializa√ß√£o principal da aplica√ß√£o
             *
             * ‚ö†Ô∏è ORDEM CR√çTICA DE EXECU√á√ÉO:
             *
             * 1. loadConfig()
             *    - Carrega config.json e messages.json via fetch
             *    - Exp√µe window.CONFIG e window.MESSAGES (global)
             *    - Atualiza t√≠tulo da p√°gina
             *
             * 2. checkDependencies()
             *    - Valida que todas as classes est√£o dispon√≠veis no window
             *    - Lista: ConfigLoader, FormGenerator, NavigationController,
             *             AutoSave, CreditScoreModule, HierarchicalNavigation,
             *             CreditscoreIndexedDB
             *
             * 3. initBasicModules()
             *    - ConfigLoader (sem depend√™ncias externas)
             *    - FormGenerator (depende de config + messages)
             *    - CreditScoreModule (depende de config + window.MESSAGES)
             *
             * 4. generateInterface()
             *    - Gera tabs HTML baseado em config.modules
             *    - Gera form content HTML usando FormGenerator
             *    - **CRIA .tab-item no DOM** (cr√≠tico para pr√≥ximo passo!)
             *    - Aplica m√°scaras currency
             *
             * 5. initNavigationAndDB()
             *    - HierarchicalNavigation (AGORA tabs existem no DOM!)
             *    - Nota: CreditscoreIndexedDB j√° inicializado por CreditScoreModule
             *
             * 6. initDependentModules()
             *    - NavigationController (depende de hierarchicalNav)
             *    - AutoSave (depende de dbManager)
             *
             * 7. setupNavigation() + setupAutoSave()
             *    - Configura event listeners para bot√µes
             *    - Ativa auto-save com intervalo configurado
             *
             * 8. attemptDataRestore()
             *    - Tenta restaurar dados salvos do IndexedDB
             *    - Confirma com usu√°rio se h√° dados
             *
             * 9. showInterface()
             *    - Esconde loading state
             *    - Mostra formul√°rio
             *    - Sistema pronto para uso
             *
             * ‚ö†Ô∏è N√ÉO ALTERAR ORDEM - Race conditions podem ocorrer!
             * Especialmente a ordem 4 ‚Üí 5 (gerar interface antes de HierarchicalNavigation)
             *
             * @returns {Promise<void>}
             * @throws {Error} Se inicializa√ß√£o falhar em qualquer etapa
             *
             * @see PHASE1-IMPLEMENTATION.md para detalhes completos
             * @see ARCHITECTURAL-ANALYSIS.md para an√°lise de depend√™ncias
             */
            /**
             * Inicializa√ß√£o principal usando Dependency Injection
             * ARQUITETURA: Two-Phase Init (Construction ‚Üí Initialization)
             *
             * ORDEM CR√çTICA (N√ÉO ALTERAR):
             *
             * FASE 1: Configura√ß√£o
             *   - loadConfig() ‚Üí window.CONFIG, window.MESSAGES
             *   - checkDependencies()
             *
             * FASE 2: Inst√¢ncias SEM DOM
             *   - ConfigLoader ‚Üí window.configLoader (global)
             *   - FormGenerator ‚Üí this.modules.get('formGenerator')
             *   - Database ‚Üí window.CreditscoreIndexedDB, dbManager proxy
             *
             * FASE 3: Gera√ß√£o do DOM
             *   - generateInterface() ‚Üí cria .tab-item no DOM
             *
             * FASE 4: Inst√¢ncias P√ìS-DOM
             *   - HierarchicalNavigation.initAfterDOM() ‚Üí this.hierarchicalNav
             *   - NavigationController ‚Üí injeta hierarchicalNav
             *   - AutoSave ‚Üí injeta navigationController
             *   - CreditScoreModule ‚Üí injeta TODAS as depend√™ncias
             *
             * FASE 5: Setup & Restore
             * FASE 6: Valida√ß√£o & Finaliza√ß√£o
             */
            async init() {
                try {
                    // ========================================
                    // FASE 1: CARREGAMENTO DE CONFIGURA√á√ÉO
                    // ========================================
                    await this.loadConfig();
                    // Exp√µe: window.CONFIG, window.MESSAGES

                    this.checkDependencies();
                    // Valida: window.HierarchicalNavigation, FormGenerator, etc. existem

                    // ========================================
                    // FASE 2: CRIA√á√ÉO DE INST√ÇNCIAS (SEM DOM)
                    // ========================================

                    // 2.1. ConfigLoader (PRIMEIRO - sem depend√™ncias)
                    const configLoader = new window.ConfigLoader(this.config);
                    await configLoader.init();
                    window.configLoader = configLoader; // Exp√µe globalmente (CreditscoreIndexedDB depende)
                    this.modules.set('config', configLoader);
                    console.log('‚úÖ ConfigLoader inicializado');

                    // 2.2. FormGenerator (precisa de config + messages)
                    const formGenerator = new window.FormGenerator(this.config, this.messages);
                    await formGenerator.init();
                    this.modules.set('formGenerator', formGenerator);
                    console.log('‚úÖ FormGenerator inicializado');

                    // 2.3. CreditscoreIndexedDB (precisa de window.configLoader validado)
                    await window.CreditscoreIndexedDB.openDatabase();
                    this.dbManager = this.#createDBManagerProxy();
                    console.log('‚úÖ Database inicializado');

                    // ========================================
                    // FASE 3: GERA√á√ÉO DO DOM
                    // ========================================
                    // AGORA FormGenerator existe em this.modules.get('formGenerator')
                    await this.generateInterface(); // Cria .tab-item no DOM

                    // ========================================
                    // FASE 4: INICIALIZA√á√ÉO P√ìS-DOM
                    // ========================================

                    // 4.1. HierarchicalNavigation (AGORA .tab-item existe)
                    this.hierarchicalNav = new window.HierarchicalNavigation();
                    this.hierarchicalNav.initAfterDOM(); // ‚úÖ Inicializa com DOM pronto
                    window.hierarchicalNavigation = this.hierarchicalNav;
                    console.log('‚úÖ HierarchicalNavigation inicializado');

                    // 4.2. NavigationController (precisa de hierarchicalNav)
                    const navigationController = new window.NavigationController(
                        this.config,
                        this.messages,
                        this.hierarchicalNav
                    );
                    await navigationController.init();
                    this.modules.set('navigation', navigationController);
                    console.log('‚úÖ NavigationController inicializado');

                    // 4.3. AutoSave (precisa de dbManager + navigationController)
                    const autoSave = new window.AutoSave(
                        this.config,
                        this.messages,
                        this.dbManager
                    );
                    await autoSave.init(null, navigationController); // null = creditScoreModule opcional
                    this.modules.set('autoSave', autoSave);
                    console.log('‚úÖ AutoSave inicializado');

                    // 4.4. CreditScoreModule (recebe TODAS as depend√™ncias)
                    const creditScore = new window.CreditScoreModule(this.config);

                    // ‚úÖ INJETAR DEPEND√äNCIAS antes de init()
                    creditScore.hierarchicalNav = this.hierarchicalNav;
                    creditScore.navigationController = navigationController;
                    creditScore.autoSave = autoSave;
                    creditScore.dbManager = this.dbManager;
                    creditScore.formGenerator = formGenerator;
                    creditScore.scoringCriteria = this.scoringCriteria; // ‚úÖ Passa scoring criteria para ScoringEngine

                    await creditScore.init();
                    this.modules.set('creditScore', creditScore);
                    console.log('‚úÖ CreditScoreModule inicializado');

                    // ========================================
                    // FASE 5: SETUP & RESTORE
                    // ========================================
                    this.setupNavigation();
                    this.setupAutoSave();
                    await this.attemptDataRestore();

                    // ========================================
                    // FASE 6: VALIDA√á√ÉO & FINALIZA√á√ÉO
                    // ========================================
                    // Validar que m√≥dulos foram criados na ordem correta
                    this.#validateInitializationOrder();

                    this.initialized = true;
                    this.showInterface();
                    console.log('‚úÖ CreditScore Pro inicializado com sucesso');

                } catch (error) {
                    console.error('‚ùå Erro na inicializa√ß√£o:', error);
                    this.showError('Erro ao inicializar o sistema', error.message);
                }
            }

            /**
             * Cria proxy object para CreditscoreIndexedDB (static methods ‚Üí instance-like)
             * @private
             */
#createDBManagerProxy() {
                return {
                    init: async () => window.CreditscoreIndexedDB.openDatabase(),
                    get: (storeName, key) => window.CreditscoreIndexedDB.get(storeName, key),
                    save: (storeName, data) => window.CreditscoreIndexedDB.save(storeName, data),
                    delete: (storeName, key) => window.CreditscoreIndexedDB.delete(storeName, key),
                    getAll: (storeName, indexName) => window.CreditscoreIndexedDB.getAll(storeName, indexName),
                    clear: (storeName) => window.CreditscoreIndexedDB.clear(storeName)
                };
            }

            /**
             * Valida ordem de inicializa√ß√£o
             * Garante que depend√™ncias foram criadas na ordem correta
             * @private
             * @throws {Error} Se ordem est√° incorreta
             */
            #validateInitializationOrder() {
                const requiredOrder = [
                    'config',        // 1. ConfigLoader
                    'formGenerator', // 2. FormGenerator
                    // (dbManager n√£o est√° em modules, √© this.dbManager)
                    // (generateInterface cria DOM)
                    // (hierarchicalNav n√£o est√° em modules, √© this.hierarchicalNav)
                    'navigation',    // 3. NavigationController
                    'autoSave',      // 4. AutoSave
                    'creditScore'    // 5. CreditScoreModule
                ];

                const moduleKeys = Array.from(this.modules.keys());

                for (let i = 0; i < requiredOrder.length; i++) {
                    const expected = requiredOrder[i];

                    if (!this.modules.has(expected)) {
                        throw new Error(`Ordem de inicializa√ß√£o incorreta: m√≥dulo "${expected}" deveria estar em posi√ß√£o ${i + 1}, mas n√£o existe`);
                    }

                    // Verificar se existe antes dos esperados posteriormente
                    const position = moduleKeys.indexOf(expected);
                    for (let j = i + 1; j < requiredOrder.length; j++) {
                        const laterModule = requiredOrder[j];
                        const laterPosition = moduleKeys.indexOf(laterModule);

                        if (laterPosition !== -1 && laterPosition < position) {
                            throw new Error(`Ordem de inicializa√ß√£o incorreta: "${laterModule}" foi criado antes de "${expected}"`);
                        }
                    }
                }

                console.log('‚úÖ Ordem de inicializa√ß√£o validada');
            }

            /**
             * Carrega configura√ß√£o do sistema e messages
             */
            async loadConfig() {
                try {
                    // Carregar config, messages E scoring-criteria em paralelo (Performance)
                    const [configResponse, messagesResponse, scoringCriteriaResponse] = await Promise.all([
                        fetch('../../config/creditscore-config.json'),
                        fetch('../../config/messages.json'),
                        fetch('../../config/scoring-criteria.json')
                    ]);

                    if (!configResponse.ok) {
                        throw new Error(`Config: HTTP ${configResponse.status}: ${configResponse.statusText}`);
                    }
                    if (!messagesResponse.ok) {
                        throw new Error(`Messages: HTTP ${messagesResponse.status}: ${messagesResponse.statusText}`);
                    }
                    if (!scoringCriteriaResponse.ok) {
                        throw new Error(`Scoring Criteria: HTTP ${scoringCriteriaResponse.status}: ${scoringCriteriaResponse.statusText}`);
                    }

                    this.config = await configResponse.json();
                    this.messages = await messagesResponse.json();
                    this.scoringCriteria = await scoringCriteriaResponse.json();

                    // Expor como globais para compatibilidade com m√≥dulos legados
                    // TODO FASE 2: Remover ap√≥s migrar CreditScoreModule para Dependency Injection
                    window.CONFIG = this.config;
                    window.MESSAGES = this.messages;

                    // Atualizar t√≠tulo da p√°gina
                    document.title = `${this.config.systemName} | Expertzy`;
                    document.getElementById('systemTitle').textContent = this.config.systemName;
                    document.getElementById('systemSubtitle').textContent = this.config.description;

                    console.log('‚úÖ Configura√ß√£o carregada:', this.config.systemName, 'v' + this.config.version);
                    console.log('‚úÖ Messages carregado');
                    console.log('‚úÖ Scoring Criteria carregado');

                } catch (error) {
                    throw new Error(`Falha ao carregar configura√ß√£o: ${error.message}`);
                }
            }
            
            /**
             * Verifica depend√™ncias obrigat√≥rias
             */
            checkDependencies() {
                const requiredClasses = [
                    'ConfigLoader',
                    'FormGenerator',
                    'NavigationController',
                    'AutoSave',
                    'CreditScoreModule',
                    'HierarchicalNavigation',
                    'CreditscoreIndexedDB'
                ];

                const missing = requiredClasses.filter(cls => typeof window[cls] === 'undefined');

                if (missing.length > 0) {
                    throw new Error(`Depend√™ncias ausentes: ${missing.join(', ')}`);
                }

                console.log('‚úÖ Depend√™ncias verificadas');
            }
            
            // ============================================
            // M√âTODOS OBSOLETOS REMOVIDOS
            // ============================================
            // - initBasicModules() (substitu√≠do por fluxo √∫nico em init())
            // - initNavigationAndDB() (substitu√≠do por fluxo √∫nico em init())
            // - initDependentModules() (substitu√≠do por fluxo √∫nico em init())
            //
            // Raz√£o: Two-Phase Initialization pattern agora implementado
            // diretamente no m√©todo init() principal (linhas 254-329)
            // ============================================
            
            /**
             * Gera interface baseada na configura√ß√£o
             * Cria tabs e form content dinamicamente
             *
             * ‚ö†Ô∏è PR√â-REQUISITO: FormGenerator DEVE estar inicializado
             * Este m√©todo √© chamado na FASE 3 do init(), ap√≥s FormGenerator ser criado na FASE 2
             */
            async generateInterface() {
                const formGenerator = this.modules.get('formGenerator');

                // Valida√ß√£o cr√≠tica: FormGenerator DEVE existir
                if (!formGenerator) {
                    throw new Error('generateInterface: FormGenerator n√£o inicializado - DEVE ser criado antes de chamar este m√©todo');
                }

                // 1. Gerar tabs de navega√ß√£o
                const tabsHTML = this.config.modules.map(module => `
                    <div class="tab-item ${module.id === 1 ? 'active' : ''}" data-module="${module.id}">
                        <span class="tab-icon">${module.icon}</span>
                        <span class="tab-label">${module.title}</span>
                        ${module.computed ? '<span class="computed-badge">Auto</span>' : ''}
                    </div>
                `).join('');

                // Injetar tabs no DOM
                const tabNav = document.getElementById('tabNavigation');
                if (tabNav) {
                    tabNav.innerHTML = tabsHTML;
                }

                // 2. Gerar conte√∫do dos formul√°rios para cada m√≥dulo
                const formContentHTML = this.config.modules.map(module => {
                    try {
                        return formGenerator.generateModuleHTML(module.id);
                    } catch (error) {
                        console.error(`Erro ao gerar m√≥dulo ${module.id}:`, error);
                        return `<div class="module-content error-state" data-module="${module.id}" style="display:none;">
                            <h2>‚ö†Ô∏è Erro ao carregar m√≥dulo ${module.title}</h2>
                            <p>${error.message}</p>
                        </div>`;
                    }
                }).join('');

                // Injetar form content no DOM
                const formContent = document.getElementById('formContent');
                if (formContent) {
                    formContent.innerHTML = formContentHTML;
                }

                // 3. Ativar listeners de m√°scaras e valida√ß√£o
                if (window.currencyMask) {
                    window.currencyMask.init(); // ‚úÖ M√©todo correto: init() (n√£o applyToAll)
                }

                console.log('‚úÖ Interface gerada');
            }
            
            /**
             * Configura sistema de navega√ß√£o
             */
            setupNavigation() {
                const navigation = this.modules.get('navigation');

                // Event listeners para bot√µes de navega√ß√£o
                document.getElementById('nextBtn').addEventListener('click', () => {
                    // NavigationController.navigateToModule() j√° valida limites e depend√™ncias
                    const nextModuleId = navigation.currentModule + 1;
                    if (nextModuleId <= this.config.totalSteps) {
                        navigation.navigateToModule(nextModuleId);
                    }
                });

                document.getElementById('prevBtn').addEventListener('click', () => {
                    // Navega√ß√£o para tr√°s sempre permitida
                    const prevModuleId = navigation.currentModule - 1;
                    if (prevModuleId >= 1) {
                        navigation.navigateToModule(prevModuleId);
                    }
                });

                // Tab click handlers j√° configurados por HierarchicalNavigation.initAfterDOM()
                // N√£o √© necess√°rio chamar setupTabClickHandlers() aqui

                console.log('‚úÖ Navega√ß√£o configurada');
            }
            
            /**
             * Configura auto-save
             */
            setupAutoSave() {
                const autoSave = this.modules.get('autoSave');
                
                // Event listeners para mudan√ßas no formul√°rio
                document.getElementById('creditScoreForm').addEventListener('input', () => {
                    autoSave.scheduleAutoSave();
                });
                
                document.getElementById('creditScoreForm').addEventListener('change', () => {
                    autoSave.scheduleAutoSave();
                });
                
                // Event listener para salvar manual
                document.getElementById('saveBtn').addEventListener('click', () => {
                    autoSave.saveNow();
                });
                
                // Event listener para antes de sair da p√°gina
                window.addEventListener('beforeunload', () => {
                    autoSave.saveNow();
                });
                
                console.log('‚úÖ Auto-save configurado');
            }
            
            /**
             * Tenta restaurar dados salvos
             */
            async attemptDataRestore() {
                const autoSave = this.modules.get('autoSave');
                
                try {
                    const savedData = await autoSave.loadSavedData();
                    
                    if (savedData && Object.keys(savedData).length > 0) {
                        const restore = confirm('Dados de uma sess√£o anterior foram encontrados. Deseja restaur√°-los?');
                        
                        if (restore) {
                            await this.restoreFormData(savedData);
                            this.showAlert('success', 'Dados restaurados com sucesso');
                        }
                    }
                } catch (error) {
                    console.log('‚ÑπÔ∏è Nenhum dado anterior encontrado');
                }
            }
            
            /**
             * Restaura dados no formul√°rio
             */
            async restoreFormData(data) {
                // Implementar restaura√ß√£o de dados
                // TODO: Implementar l√≥gica de restaura√ß√£o
                console.log('üì• Restaurando dados:', data);
            }
            
            /**
             * Mostra interface principal
             */
            showInterface() {
                document.getElementById('loadingState').style.display = 'none';
                document.getElementById('formContent').style.display = 'block';
                document.getElementById('formActions').style.display = 'block';
                document.getElementById('progressContainer').style.display = 'block';
                document.getElementById('tabNavigation').style.display = 'flex';
            }
            
            /**
             * Mostra erro para o usu√°rio
             */
            showError(title, message) {
                const errorHtml = `
                    <div class="alert alert-danger">
                        <h4>${title}</h4>
                        <p>${message}</p>
                        <button onclick="location.reload()" class="btn btn-primary mt-3">
                            Recarregar P√°gina
                        </button>
                    </div>
                `;
                
                document.getElementById('loadingState').innerHTML = errorHtml;
            }
            
            /**
             * Mostra alerta para o usu√°rio
             */
            showAlert(type, message) {
                const alertHtml = `
                    <div class="alert alert-${type} alert-dismissible">
                        ${message}
                        <button type="button" class="alert-close" onclick="this.parentElement.remove()">√ó</button>
                    </div>
                `;
                
                const container = document.getElementById('alertContainer');
                container.innerHTML = alertHtml;
                
                // Auto-remove ap√≥s 5 segundos
                setTimeout(() => {
                    const alert = container.querySelector('.alert');
                    if (alert) alert.remove();
                }, 5000);
            }
        }
        
        // Inicializar aplica√ß√£o quando DOM estiver pronto
        document.addEventListener('DOMContentLoaded', () => {
            window.creditScoreApp = new CreditScoreProApp();
            window.creditScoreApp.init();
        });
        
        // Prevenir perda de dados ao sair da p√°gina
        window.addEventListener('beforeunload', (e) => {
            if (window.creditScoreApp && window.creditScoreApp.initialized) {
                e.preventDefault();
                e.returnValue = 'Voc√™ tem altera√ß√µes n√£o salvas. Deseja realmente sair?';
                return e.returnValue;
            }
        });
    </script>
</body>
</html>