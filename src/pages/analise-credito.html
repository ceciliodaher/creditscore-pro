<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="author" content="Expertzy Intelig√™ncia Tribut√°ria">
    <meta name="description" content="CreditScore Pro - Sistema de An√°lise de Cr√©dito e Compliance Financeiro">
    <title>CreditScore Pro | Expertzy Intelig√™ncia Tribut√°ria</title>
    
    <!-- Tailwind CSS (deve vir primeiro) -->
    <link rel="stylesheet" href="../assets/css/tailwind.css">

    <!-- Estilos Base -->
    <link rel="stylesheet" href="../assets/css/styles-base.css">
    <link rel="stylesheet" href="../assets/css/tabs.css">
    <link rel="stylesheet" href="../assets/css/creditscore-styles.css">

    <!-- Favicon -->
    <link rel="icon" type="image/png" href="../assets/images/expertzy_logo.png">
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@100;300;400;500;600;700;800;900&display=swap" rel="stylesheet">
</head>
<body>
    <!-- Header Expertzy -->
    <header class="header">
        <div class="container">
            <div class="header-content">
                <div class="logo">
                    <img src="../assets/images/logo-expertzy-azul-maior.png" alt="Expertzy" class="logo-image">
                </div>
                
                <div class="header-title">
                    <h1 class="form-title" id="systemTitle">CreditScore Pro</h1>
                    <p class="form-subtitle" id="systemSubtitle">Sistema de An√°lise de Cr√©dito e Compliance Financeiro</p>
                </div>
                
                <div class="header-actions">
                    <button type="button" class="btn btn-secondary" id="importBtnHeader">
                        üì§ Importar
                    </button>
                    <input type="file" id="importJsonFileHeader" accept=".json" style="display: none;">
                    
                    <button type="button" class="btn btn-secondary" id="exportJsonBtn">
                        üíæ Exportar JSON
                    </button>
                    
                    <button type="button" class="btn btn-secondary" id="exportExcelBtn">
                        üìä Excel
                    </button>
                    
                    <button type="button" class="btn btn-secondary" id="exportPDFBtn">
                        üìÑ PDF
                    </button>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="progress-container" id="progressContainer">
        <div class="progress-bar">
            <div class="progress-fill" id="progressFill"></div>
        </div>
        <div class="progress-info">
            <span class="progress-text" id="progressText">Carregando...</span>
            <span class="progress-percentage" id="progressPercentage">0%</span>
        </div>
    </div>

    <!-- Tab Navigation -->
    <nav class="tab-navigation" id="tabNavigation">
        <!-- Tabs ser√£o geradas dinamicamente pelo JavaScript -->
    </nav>

    <!-- Main Content -->
    <main class="main">
        <div class="container">
            <form id="creditScoreForm" class="form-container" novalidate>
                <!-- Loading State -->
                <div class="loading-state" id="loadingState">
                    <div class="loading"></div>
                    <p>Carregando configura√ß√µes do sistema...</p>
                </div>

                <!-- Form Content -->
                <div class="form-content" id="formContent">

                    <!-- ========================================= -->
                    <!-- SE√á√ÉO 1: CADASTRO E IDENTIFICA√á√ÉO -->
                    <!-- ========================================= -->
                    <div class="form-section active" data-module="cadastro" id="section-1" role="tabpanel">
                        <div class="section-header">
                            <h2 class="section-title">üè¢ Cadastro e Identifica√ß√£o</h2>
                            <p class="section-description">Dados cadastrais da empresa para an√°lise de cr√©dito</p>
                        </div>

                        <div class="form-grid">
                            <div class="form-group">
                                <label for="razaoSocial">Raz√£o Social *</label>
                                <input type="text" id="razaoSocial" name="razaoSocial" required>
                            </div>

                            <div class="form-group">
                                <label for="nomeFantasia">Nome Fantasia</label>
                                <input type="text" id="nomeFantasia" name="nomeFantasia">
                            </div>

                            <div class="form-group">
                                <label for="cnpj">CNPJ *</label>
                                <input type="text" id="cnpj" name="cnpj" data-mask="cnpj" required>
                            </div>

                            <div class="form-group">
                                <label for="inscricaoEstadual">Inscri√ß√£o Estadual</label>
                                <input type="text" id="inscricaoEstadual" name="inscricaoEstadual">
                            </div>

                            <div class="form-group">
                                <label for="dataConstituicao">Data de Constitui√ß√£o *</label>
                                <input type="date" id="dataConstituicao" name="dataConstituicao" required>
                            </div>

                            <div class="form-group">
                                <label for="uf">Estado (UF) *</label>
                                <select id="uf" name="uf" required>
                                    <option value="">Selecione</option>
                                    <option value="AC">Acre</option>
                                    <option value="AL">Alagoas</option>
                                    <option value="AP">Amap√°</option>
                                    <option value="AM">Amazonas</option>
                                    <option value="BA">Bahia</option>
                                    <option value="CE">Cear√°</option>
                                    <option value="DF">Distrito Federal</option>
                                    <option value="ES">Esp√≠rito Santo</option>
                                    <option value="GO">Goi√°s</option>
                                    <option value="MA">Maranh√£o</option>
                                    <option value="MT">Mato Grosso</option>
                                    <option value="MS">Mato Grosso do Sul</option>
                                    <option value="MG">Minas Gerais</option>
                                    <option value="PA">Par√°</option>
                                    <option value="PB">Para√≠ba</option>
                                    <option value="PR">Paran√°</option>
                                    <option value="PE">Pernambuco</option>
                                    <option value="PI">Piau√≠</option>
                                    <option value="RJ">Rio de Janeiro</option>
                                    <option value="RN">Rio Grande do Norte</option>
                                    <option value="RS">Rio Grande do Sul</option>
                                    <option value="RO">Rond√¥nia</option>
                                    <option value="RR">Roraima</option>
                                    <option value="SC">Santa Catarina</option>
                                    <option value="SP">S√£o Paulo</option>
                                    <option value="SE">Sergipe</option>
                                    <option value="TO">Tocantins</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label for="municipio">Munic√≠pio *</label>
                                <input type="text" id="municipio" name="municipio" required>
                            </div>

                            <div class="form-group">
                                <label for="endereco">Endere√ßo Completo *</label>
                                <textarea id="endereco" name="endereco" rows="2" required></textarea>
                            </div>

                            <div class="form-group">
                                <label for="atividadePrincipal">Atividade Principal *</label>
                                <select id="atividadePrincipal" name="atividadePrincipal" required>
                                    <option value="">Selecione</option>
                                    <option value="comercio">Com√©rcio</option>
                                    <option value="industria">Ind√∫stria</option>
                                    <option value="servicos">Servi√ßos</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label for="capitalSocial">Capital Social (R$) *</label>
                                <input type="text" id="capitalSocial" name="capitalSocial" data-mask="currency" required>
                            </div>

                            <div class="form-group">
                                <label for="regimeTributario">Regime Tribut√°rio *</label>
                                <select id="regimeTributario" name="regimeTributario" required>
                                    <option value="">Selecione</option>
                                    <option value="lucro_real">Lucro Real</option>
                                    <option value="lucro_presumido">Lucro Presumido</option>
                                    <option value="simples_nacional">Simples Nacional</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- ========================================= -->
                    <!-- SE√á√ÉO 2: DEMONSTRA√á√ïES FINANCEIRAS -->
                    <!-- Balan√ßo Patrimonial + DRE -->
                    <!-- ========================================= -->
                    <div class="form-section" data-module="demonstracoes" id="section-2" role="tabpanel">
                        <div class="section-header">
                            <h2 class="section-title">üìä Demonstra√ß√µes Financeiras</h2>
                            <p class="section-description">Balan√ßo Patrimonial e DRE dos √∫ltimos 3 anos + 1 balancete</p>
                        </div>

                        <!-- Configura√ß√£o de Per√≠odos -->
                    <div class="periodos-config" style="margin-bottom: 2rem; padding: 1.5rem; background: #f8f9fa; border-radius: 8px;">
                        <h3 style="color: #091A30; margin-bottom: 1rem;">üìÖ Configurar Per√≠odos</h3>
                        <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 1rem;">
                            <div class="form-group">
                                <label for="periodo1Data"><strong>Per√≠odo 1:</strong> Ano N-2</label>
                                <input type="date" id="periodo1Data" name="periodo1Data" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                                <small style="color: #666;">Ex: 31/12/2022</small>
                            </div>
                            <div class="form-group">
                                <label for="periodo2Data"><strong>Per√≠odo 2:</strong> Ano N-1</label>
                                <input type="date" id="periodo2Data" name="periodo2Data" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                                <small style="color: #666;">Ex: 31/12/2023</small>
                            </div>
                            <div class="form-group">
                                <label for="periodo3Data"><strong>Per√≠odo 3:</strong> Ano N</label>
                                <input type="date" id="periodo3Data" name="periodo3Data" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                                <small style="color: #666;">Ex: 31/12/2024</small>
                            </div>
                            <div class="form-group">
                                <label for="periodo4Data"><strong>Per√≠odo 4:</strong> Balancete Atual</label>
                                <input type="date" id="periodo4Data" name="periodo4Data" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                                <small style="color: #666;">Ex: 30/09/2025</small>
                            </div>
                        </div>
                    </div>

                    <!-- Tabela Matricial Cronol√≥gica COMPLETA (50 contas √ó 4 per√≠odos = 200 inputs) -->
                    <div class="balanco-container">
                        <table class="balanco-cronologico" >
                            <thead>
                                <tr>
                                    <th rowspan="2">CONTA</th>
                                    <th colspan="4">PER√çODOS (R$)</th>
                                </tr>
                                <tr>
                                    <th>Per√≠odo 1<br>(Ano N-2)</th>
                                    <th>Per√≠odo 2<br>(Ano N-1)</th>
                                    <th>Per√≠odo 3<br>(Ano N)</th>
                                    <th>Per√≠odo 4<br>(Balancete)</th>
                                </tr>
                            </thead>

                            <tbody id="ativo-body">
                                <!-- ============================================ -->
                                <!-- GRUPO: ATIVO -->
                                <!-- ============================================ -->
                                <tr class="grupo-header">
                                    <td colspan="5">
                                        <strong>‚ñº ATIVO</strong>
                                    </td>
                                </tr>

                                <!-- ========== 1. ATIVO CIRCULANTE (12 contas) ========== -->
                                <tr class="subcategoria-level1">
                                    <td>1. ATIVO CIRCULANTE</td>
                                    <td colspan="4"></td>
                                </tr>

                                <!-- 1.1 Caixa e Equivalentes -->
                                <tr class="conta-row">
                                    <td>1.1 Caixa e Equivalentes de Caixa</td>
                                    <td><input type="text" id="caixa_p1" class="input-valor"></td>
                                    <td><input type="text" id="caixa_p2" class="input-valor"></td>
                                    <td><input type="text" id="caixa_p3" class="input-valor"></td>
                                    <td><input type="text" id="caixa_p4" class="input-valor"></td>
                                </tr>

                                <!-- 1.2 Bancos -->
                                <tr class="conta-row">
                                    <td>1.2 Bancos</td>
                                    <td><input type="text" id="bancos_p1" class="input-valor"></td>
                                    <td><input type="text" id="bancos_p2" class="input-valor"></td>
                                    <td><input type="text" id="bancos_p3" class="input-valor"></td>
                                    <td><input type="text" id="bancos_p4" class="input-valor"></td>
                                </tr>

                                <!-- 1.3 Aplica√ß√µes Financeiras -->
                                <tr class="conta-row">
                                    <td>1.3 Aplica√ß√µes Financeiras</td>
                                    <td><input type="text" id="aplicacoes_p1" class="input-valor"></td>
                                    <td><input type="text" id="aplicacoes_p2" class="input-valor"></td>
                                    <td><input type="text" id="aplicacoes_p3" class="input-valor"></td>
                                    <td><input type="text" id="aplicacoes_p4" class="input-valor"></td>
                                </tr>

                                <!-- 1.4 Contas a Receber -->
                                <tr class="conta-row">
                                    <td>1.4 Contas a Receber</td>
                                    <td><input type="text" id="contasReceber_p1" class="input-valor"></td>
                                    <td><input type="text" id="contasReceber_p2" class="input-valor"></td>
                                    <td><input type="text" id="contasReceber_p3" class="input-valor"></td>
                                    <td><input type="text" id="contasReceber_p4" class="input-valor"></td>
                                </tr>

                                <!-- 1.5 (-) PDD - Provis√£o Devedores Duvidosos -->
                                <tr class="conta-row negative-account">
                                    <td>1.5 (-) PDD - Provis√£o Devedores Duvidosos</td>
                                    <td><input type="text" id="pdd_p1" class="input-valor"></td>
                                    <td><input type="text" id="pdd_p2" class="input-valor"></td>
                                    <td><input type="text" id="pdd_p3" class="input-valor"></td>
                                    <td><input type="text" id="pdd_p4" class="input-valor"></td>
                                </tr>

                                <!-- 1.6 Estoques - Mat√©ria-Prima -->
                                <tr class="conta-row">
                                    <td>1.6 Estoques - Mat√©ria-Prima</td>
                                    <td><input type="text" id="estoqueMP_p1" class="input-valor"></td>
                                    <td><input type="text" id="estoqueMP_p2" class="input-valor"></td>
                                    <td><input type="text" id="estoqueMP_p3" class="input-valor"></td>
                                    <td><input type="text" id="estoqueMP_p4" class="input-valor"></td>
                                </tr>

                                <!-- 1.7 Estoques - Produtos em Processo -->
                                <tr class="conta-row">
                                    <td>1.7 Estoques - Produtos em Processo (WIP)</td>
                                    <td><input type="text" id="estoqueWIP_p1" class="input-valor"></td>
                                    <td><input type="text" id="estoqueWIP_p2" class="input-valor"></td>
                                    <td><input type="text" id="estoqueWIP_p3" class="input-valor"></td>
                                    <td><input type="text" id="estoqueWIP_p4" class="input-valor"></td>
                                </tr>

                                <!-- 1.8 Estoques - Produtos Acabados -->
                                <tr class="conta-row">
                                    <td>1.8 Estoques - Produtos Acabados</td>
                                    <td><input type="text" id="estoqueProdAcabados_p1" class="input-valor"></td>
                                    <td><input type="text" id="estoqueProdAcabados_p2" class="input-valor"></td>
                                    <td><input type="text" id="estoqueProdAcabados_p3" class="input-valor"></td>
                                    <td><input type="text" id="estoqueProdAcabados_p4" class="input-valor"></td>
                                </tr>

                                <!-- 1.9 Estoques - Pe√ßas de Reposi√ß√£o -->
                                <tr class="conta-row">
                                    <td>1.9 Estoques - Pe√ßas de Reposi√ß√£o</td>
                                    <td><input type="text" id="estoquePecasReposicao_p1" class="input-valor"></td>
                                    <td><input type="text" id="estoquePecasReposicao_p2" class="input-valor"></td>
                                    <td><input type="text" id="estoquePecasReposicao_p3" class="input-valor"></td>
                                    <td><input type="text" id="estoquePecasReposicao_p4" class="input-valor"></td>
                                </tr>

                                <!-- 1.10 Impostos a Recuperar -->
                                <tr class="conta-row">
                                    <td>1.10 Impostos a Recuperar</td>
                                    <td><input type="text" id="impostosRecuperar_p1" class="input-valor"></td>
                                    <td><input type="text" id="impostosRecuperar_p2" class="input-valor"></td>
                                    <td><input type="text" id="impostosRecuperar_p3" class="input-valor"></td>
                                    <td><input type="text" id="impostosRecuperar_p4" class="input-valor"></td>
                                </tr>

                                <!-- 1.11 Adiantamentos a Fornecedores -->
                                <tr class="conta-row">
                                    <td>1.11 Adiantamentos a Fornecedores</td>
                                    <td><input type="text" id="adiantamentosFornecedores_p1" class="input-valor"></td>
                                    <td><input type="text" id="adiantamentosFornecedores_p2" class="input-valor"></td>
                                    <td><input type="text" id="adiantamentosFornecedores_p3" class="input-valor"></td>
                                    <td><input type="text" id="adiantamentosFornecedores_p4" class="input-valor"></td>
                                </tr>

                                <!-- 1.12 Outros Ativos Circulantes -->
                                <tr class="conta-row">
                                    <td>1.12 Outros Ativos Circulantes</td>
                                    <td><input type="text" id="outrosAC_p1" class="input-valor"></td>
                                    <td><input type="text" id="outrosAC_p2" class="input-valor"></td>
                                    <td><input type="text" id="outrosAC_p3" class="input-valor"></td>
                                    <td><input type="text" id="outrosAC_p4" class="input-valor"></td>
                                </tr>

                                <!-- SUBTOTAL ATIVO CIRCULANTE -->
                                <tr class="subtotal-row">
                                    <td>SUBTOTAL ATIVO CIRCULANTE</td>
                                    <td class="subtotal-valor" id="ativoCirculanteTotal_p1">-</td>
                                    <td class="subtotal-valor" id="ativoCirculanteTotal_p2">-</td>
                                    <td class="subtotal-valor" id="ativoCirculanteTotal_p3">-</td>
                                    <td class="subtotal-valor" id="ativoCirculanteTotal_p4">-</td>
                                </tr>

                                <!-- ========== 2. ATIVO N√ÉO CIRCULANTE (17 contas) ========== -->
                                <tr class="subcategoria-level1 section-divider">
                                    <td>2. ATIVO N√ÉO CIRCULANTE</td>
                                    <td colspan="4"></td>
                                </tr>

                                <!-- Realiz√°vel a Longo Prazo -->
                                <tr class="subcategoria-level2">
                                    <td>2.1 Realiz√°vel a Longo Prazo</td>
                                    <td colspan="4"></td>
                                </tr>

                                <!-- 2.1.1 T√≠tulos a Receber LP -->
                                <tr class="conta-row">
                                    <td>2.1.1 T√≠tulos a Receber LP</td>
                                    <td><input type="text" id="titulosReceberLP_p1" class="input-valor"></td>
                                    <td><input type="text" id="titulosReceberLP_p2" class="input-valor"></td>
                                    <td><input type="text" id="titulosReceberLP_p3" class="input-valor"></td>
                                    <td><input type="text" id="titulosReceberLP_p4" class="input-valor"></td>
                                </tr>

                                <!-- 2.1.2 Dep√≥sitos Judiciais -->
                                <tr class="conta-row">
                                    <td>2.1.2 Dep√≥sitos Judiciais</td>
                                    <td><input type="text" id="depositosJudiciais_p1" class="input-valor"></td>
                                    <td><input type="text" id="depositosJudiciais_p2" class="input-valor"></td>
                                    <td><input type="text" id="depositosJudiciais_p3" class="input-valor"></td>
                                    <td><input type="text" id="depositosJudiciais_p4" class="input-valor"></td>
                                </tr>

                                <!-- 2.1.3 Outros Cr√©ditos LP -->
                                <tr class="conta-row">
                                    <td>2.1.3 Outros Cr√©ditos LP</td>
                                    <td><input type="text" id="outrosCreditosLP_p1" class="input-valor"></td>
                                    <td><input type="text" id="outrosCreditosLP_p2" class="input-valor"></td>
                                    <td><input type="text" id="outrosCreditosLP_p3" class="input-valor"></td>
                                    <td><input type="text" id="outrosCreditosLP_p4" class="input-valor"></td>
                                </tr>

                                <!-- Investimentos -->
                                <tr class="subcategoria-level2">
                                    <td>2.2 Investimentos</td>
                                    <td colspan="4"></td>
                                </tr>

                                <!-- 2.2.1 Participa√ß√µes Societ√°rias -->
                                <tr class="conta-row">
                                    <td>2.2.1 Participa√ß√µes Societ√°rias</td>
                                    <td><input type="text" id="participacoesSocietarias_p1" class="input-valor"></td>
                                    <td><input type="text" id="participacoesSocietarias_p2" class="input-valor"></td>
                                    <td><input type="text" id="participacoesSocietarias_p3" class="input-valor"></td>
                                    <td><input type="text" id="participacoesSocietarias_p4" class="input-valor"></td>
                                </tr>

                                <!-- 2.2.2 Outros Investimentos -->
                                <tr class="conta-row">
                                    <td>2.2.2 Outros Investimentos</td>
                                    <td><input type="text" id="outrosInvestimentos_p1" class="input-valor"></td>
                                    <td><input type="text" id="outrosInvestimentos_p2" class="input-valor"></td>
                                    <td><input type="text" id="outrosInvestimentos_p3" class="input-valor"></td>
                                    <td><input type="text" id="outrosInvestimentos_p4" class="input-valor"></td>
                                </tr>

                                <!-- Imobilizado -->
                                <tr class="subcategoria-level2">
                                    <td>2.3 Imobilizado</td>
                                    <td colspan="4"></td>
                                </tr>

                                <!-- 2.3.1 Terrenos -->
                                <tr class="conta-row">
                                    <td>2.3.1 Terrenos</td>
                                    <td><input type="text" id="terrenos_p1" class="input-valor"></td>
                                    <td><input type="text" id="terrenos_p2" class="input-valor"></td>
                                    <td><input type="text" id="terrenos_p3" class="input-valor"></td>
                                    <td><input type="text" id="terrenos_p4" class="input-valor"></td>
                                </tr>

                                <!-- 2.3.2 Edifica√ß√µes -->
                                <tr class="conta-row">
                                    <td>2.3.2 Edifica√ß√µes</td>
                                    <td><input type="text" id="edificacoes_p1" class="input-valor"></td>
                                    <td><input type="text" id="edificacoes_p2" class="input-valor"></td>
                                    <td><input type="text" id="edificacoes_p3" class="input-valor"></td>
                                    <td><input type="text" id="edificacoes_p4" class="input-valor"></td>
                                </tr>

                                <!-- 2.3.3 M√°quinas e Equipamentos -->
                                <tr class="conta-row">
                                    <td>2.3.3 M√°quinas e Equipamentos</td>
                                    <td><input type="text" id="maquinasEquipamentos_p1" class="input-valor"></td>
                                    <td><input type="text" id="maquinasEquipamentos_p2" class="input-valor"></td>
                                    <td><input type="text" id="maquinasEquipamentos_p3" class="input-valor"></td>
                                    <td><input type="text" id="maquinasEquipamentos_p4" class="input-valor"></td>
                                </tr>

                                <!-- 2.3.4 Ve√≠culos -->
                                <tr class="conta-row">
                                    <td>2.3.4 Ve√≠culos</td>
                                    <td><input type="text" id="veiculos_p1" class="input-valor"></td>
                                    <td><input type="text" id="veiculos_p2" class="input-valor"></td>
                                    <td><input type="text" id="veiculos_p3" class="input-valor"></td>
                                    <td><input type="text" id="veiculos_p4" class="input-valor"></td>
                                </tr>

                                <!-- 2.3.5 M√≥veis e Utens√≠lios -->
                                <tr class="conta-row">
                                    <td>2.3.5 M√≥veis e Utens√≠lios</td>
                                    <td><input type="text" id="moveisUtensilios_p1" class="input-valor"></td>
                                    <td><input type="text" id="moveisUtensilios_p2" class="input-valor"></td>
                                    <td><input type="text" id="moveisUtensilios_p3" class="input-valor"></td>
                                    <td><input type="text" id="moveisUtensilios_p4" class="input-valor"></td>
                                </tr>

                                <!-- 2.3.6 Equipamentos de Inform√°tica -->
                                <tr class="conta-row">
                                    <td>2.3.6 Equipamentos de Inform√°tica</td>
                                    <td><input type="text" id="equipamentosInformatica_p1" class="input-valor"></td>
                                    <td><input type="text" id="equipamentosInformatica_p2" class="input-valor"></td>
                                    <td><input type="text" id="equipamentosInformatica_p3" class="input-valor"></td>
                                    <td><input type="text" id="equipamentosInformatica_p4" class="input-valor"></td>
                                </tr>

                                <!-- 2.3.7 Imobilizado em Andamento -->
                                <tr class="conta-row">
                                    <td>2.3.7 Imobilizado em Andamento</td>
                                    <td><input type="text" id="imobilizadoAndamento_p1" class="input-valor"></td>
                                    <td><input type="text" id="imobilizadoAndamento_p2" class="input-valor"></td>
                                    <td><input type="text" id="imobilizadoAndamento_p3" class="input-valor"></td>
                                    <td><input type="text" id="imobilizadoAndamento_p4" class="input-valor"></td>
                                </tr>

                                <!-- 2.3.8 (-) Deprecia√ß√£o Acumulada -->
                                <tr class="conta-row negative-account">
                                    <td>2.3.8 (-) Deprecia√ß√£o Acumulada</td>
                                    <td><input type="text" id="depreciacaoAcumulada_p1" class="input-valor"></td>
                                    <td><input type="text" id="depreciacaoAcumulada_p2" class="input-valor"></td>
                                    <td><input type="text" id="depreciacaoAcumulada_p3" class="input-valor"></td>
                                    <td><input type="text" id="depreciacaoAcumulada_p4" class="input-valor"></td>
                                </tr>

                                <!-- Intang√≠vel -->
                                <tr class="subcategoria-level2">
                                    <td>2.4 Intang√≠vel</td>
                                    <td colspan="4"></td>
                                </tr>

                                <!-- 2.4.1 Software -->
                                <tr class="conta-row">
                                    <td>2.4.1 Software</td>
                                    <td><input type="text" id="software_p1" class="input-valor"></td>
                                    <td><input type="text" id="software_p2" class="input-valor"></td>
                                    <td><input type="text" id="software_p3" class="input-valor"></td>
                                    <td><input type="text" id="software_p4" class="input-valor"></td>
                                </tr>

                                <!-- 2.4.2 Marcas e Patentes -->
                                <tr class="conta-row">
                                    <td>2.4.2 Marcas e Patentes</td>
                                    <td><input type="text" id="marcasPatentes_p1" class="input-valor"></td>
                                    <td><input type="text" id="marcasPatentes_p2" class="input-valor"></td>
                                    <td><input type="text" id="marcasPatentes_p3" class="input-valor"></td>
                                    <td><input type="text" id="marcasPatentes_p4" class="input-valor"></td>
                                </tr>

                                <!-- 2.4.3 Fundo de Com√©rcio (Goodwill) -->
                                <tr class="conta-row">
                                    <td>2.4.3 Fundo de Com√©rcio (Goodwill)</td>
                                    <td><input type="text" id="goodwill_p1" class="input-valor"></td>
                                    <td><input type="text" id="goodwill_p2" class="input-valor"></td>
                                    <td><input type="text" id="goodwill_p3" class="input-valor"></td>
                                    <td><input type="text" id="goodwill_p4" class="input-valor"></td>
                                </tr>

                                <!-- 2.4.4 (-) Amortiza√ß√£o Acumulada -->
                                <tr class="conta-row last-in-group negative-account">
                                    <td>2.4.4 (-) Amortiza√ß√£o Acumulada</td>
                                    <td><input type="text" id="amortizacaoAcumulada_p1" class="input-valor"></td>
                                    <td><input type="text" id="amortizacaoAcumulada_p2" class="input-valor"></td>
                                    <td><input type="text" id="amortizacaoAcumulada_p3" class="input-valor"></td>
                                    <td><input type="text" id="amortizacaoAcumulada_p4" class="input-valor"></td>
                                </tr>

                                <!-- SUBTOTAL ATIVO N√ÉO CIRCULANTE -->
                                <tr class="subtotal-row">
                                    <td>SUBTOTAL ATIVO N√ÉO CIRCULANTE</td>
                                    <td class="subtotal-valor" id="ativoNaoCirculanteTotal_p1">-</td>
                                    <td class="subtotal-valor" id="ativoNaoCirculanteTotal_p2">-</td>
                                    <td class="subtotal-valor" id="ativoNaoCirculanteTotal_p3">-</td>
                                    <td class="subtotal-valor" id="ativoNaoCirculanteTotal_p4">-</td>
                                </tr>

                                <!-- TOTAL ATIVO -->
                                <tr class="total-row">
                                    <td>TOTAL ATIVO</td>
                                    <td class="total-valor" id="ativoTotal_p1">
                                        <span class="valor">-</span>
                                        <span class="validacao-icon" id="validacao-p1">‚ö™</span>
                                    </td>
                                    <td class="total-valor" id="ativoTotal_p2">
                                        <span class="valor">-</span>
                                        <span class="validacao-icon" id="validacao-p2">‚ö™</span>
                                    </td>
                                    <td class="total-valor" id="ativoTotal_p3">
                                        <span class="valor">-</span>
                                        <span class="validacao-icon" id="validacao-p3">‚ö™</span>
                                    </td>
                                    <td class="total-valor" id="ativoTotal_p4">
                                        <span class="valor">-</span>
                                        <span class="validacao-icon" id="validacao-p4">‚ö™</span>
                                    </td>
                                </tr>
                            </tbody>

                            <tbody id="passivo-body" >
                                <!-- ============================================ -->
                                <!-- GRUPO: PASSIVO E PATRIM√îNIO L√çQUIDO -->
                                <!-- ============================================ -->
                                <tr class="grupo-header">
                                    <td colspan="5">
                                        <strong>‚ñº PASSIVO E PATRIM√îNIO L√çQUIDO</strong>
                                    </td>
                                </tr>

                                <!-- ========== 3. PASSIVO CIRCULANTE (9 contas) ========== -->
                                <tr class="subcategoria-level1 passivo">
                                    <td>3. PASSIVO CIRCULANTE</td>
                                    <td colspan="4"></td>
                                </tr>

                                <!-- 3.1 Fornecedores -->
                                <tr class="conta-row">
                                    <td>3.1 Fornecedores</td>
                                    <td><input type="text" id="fornecedores_p1" class="input-valor"></td>
                                    <td><input type="text" id="fornecedores_p2" class="input-valor"></td>
                                    <td><input type="text" id="fornecedores_p3" class="input-valor"></td>
                                    <td><input type="text" id="fornecedores_p4" class="input-valor"></td>
                                </tr>

                                <!-- 3.2 Empr√©stimos e Financiamentos CP -->
                                <tr class="conta-row">
                                    <td>3.2 Empr√©stimos e Financiamentos CP</td>
                                    <td><input type="text" id="emprestimosCP_p1" class="input-valor"></td>
                                    <td><input type="text" id="emprestimosCP_p2" class="input-valor"></td>
                                    <td><input type="text" id="emprestimosCP_p3" class="input-valor"></td>
                                    <td><input type="text" id="emprestimosCP_p4" class="input-valor"></td>
                                </tr>

                                <!-- 3.3 Sal√°rios a Pagar -->
                                <tr class="conta-row">
                                    <td>3.3 Sal√°rios a Pagar</td>
                                    <td><input type="text" id="salariosPagar_p1" class="input-valor"></td>
                                    <td><input type="text" id="salariosPagar_p2" class="input-valor"></td>
                                    <td><input type="text" id="salariosPagar_p3" class="input-valor"></td>
                                    <td><input type="text" id="salariosPagar_p4" class="input-valor"></td>
                                </tr>

                                <!-- 3.4 Encargos Sociais a Pagar -->
                                <tr class="conta-row">
                                    <td>3.4 Encargos Sociais a Pagar</td>
                                    <td><input type="text" id="encargosSociaisPagar_p1" class="input-valor"></td>
                                    <td><input type="text" id="encargosSociaisPagar_p2" class="input-valor"></td>
                                    <td><input type="text" id="encargosSociaisPagar_p3" class="input-valor"></td>
                                    <td><input type="text" id="encargosSociaisPagar_p4" class="input-valor"></td>
                                </tr>

                                <!-- 3.5 Impostos a Recolher -->
                                <tr class="conta-row">
                                    <td>3.5 Impostos a Recolher</td>
                                    <td><input type="text" id="impostosRecolher_p1" class="input-valor"></td>
                                    <td><input type="text" id="impostosRecolher_p2" class="input-valor"></td>
                                    <td><input type="text" id="impostosRecolher_p3" class="input-valor"></td>
                                    <td><input type="text" id="impostosRecolher_p4" class="input-valor"></td>
                                </tr>

                                <!-- 3.6 Dividendos a Pagar -->
                                <tr class="conta-row">
                                    <td>3.6 Dividendos a Pagar</td>
                                    <td><input type="text" id="dividendosPagar_p1" class="input-valor"></td>
                                    <td><input type="text" id="dividendosPagar_p2" class="input-valor"></td>
                                    <td><input type="text" id="dividendosPagar_p3" class="input-valor"></td>
                                    <td><input type="text" id="dividendosPagar_p4" class="input-valor"></td>
                                </tr>

                                <!-- 3.7 Adiantamentos de Clientes -->
                                <tr class="conta-row">
                                    <td>3.7 Adiantamentos de Clientes</td>
                                    <td><input type="text" id="adiantamentosClientes_p1" class="input-valor"></td>
                                    <td><input type="text" id="adiantamentosClientes_p2" class="input-valor"></td>
                                    <td><input type="text" id="adiantamentosClientes_p3" class="input-valor"></td>
                                    <td><input type="text" id="adiantamentosClientes_p4" class="input-valor"></td>
                                </tr>

                                <!-- 3.8 Obriga√ß√µes Fiscais -->
                                <tr class="conta-row">
                                    <td>3.8 Obriga√ß√µes Fiscais</td>
                                    <td><input type="text" id="obrigacoesFiscais_p1" class="input-valor"></td>
                                    <td><input type="text" id="obrigacoesFiscais_p2" class="input-valor"></td>
                                    <td><input type="text" id="obrigacoesFiscais_p3" class="input-valor"></td>
                                    <td><input type="text" id="obrigacoesFiscais_p4" class="input-valor"></td>
                                </tr>

                                <!-- 3.9 Outros Passivos Circulantes -->
                                <tr class="conta-row">
                                    <td>3.9 Outros Passivos Circulantes</td>
                                    <td><input type="text" id="outrosPC_p1" class="input-valor"></td>
                                    <td><input type="text" id="outrosPC_p2" class="input-valor"></td>
                                    <td><input type="text" id="outrosPC_p3" class="input-valor"></td>
                                    <td><input type="text" id="outrosPC_p4" class="input-valor"></td>
                                </tr>

                                <!-- SUBTOTAL PASSIVO CIRCULANTE -->
                                <tr class="subtotal-row">
                                    <td>SUBTOTAL PASSIVO CIRCULANTE</td>
                                    <td class="subtotal-valor" id="passivoCirculanteTotal_p1">-</td>
                                    <td class="subtotal-valor" id="passivoCirculanteTotal_p2">-</td>
                                    <td class="subtotal-valor" id="passivoCirculanteTotal_p3">-</td>
                                    <td class="subtotal-valor" id="passivoCirculanteTotal_p4">-</td>
                                </tr>

                                <!-- ========== 4. PASSIVO N√ÉO CIRCULANTE (6 contas) ========== -->
                                <tr class="subcategoria-level1 section-divider passivo">
                                    <td>4. PASSIVO N√ÉO CIRCULANTE</td>
                                    <td colspan="4"></td>
                                </tr>

                                <!-- 4.1 Empr√©stimos e Financiamentos LP -->
                                <tr class="conta-row">
                                    <td>4.1 Empr√©stimos e Financiamentos LP</td>
                                    <td><input type="text" id="emprestimosLP_p1" class="input-valor"></td>
                                    <td><input type="text" id="emprestimosLP_p2" class="input-valor"></td>
                                    <td><input type="text" id="emprestimosLP_p3" class="input-valor"></td>
                                    <td><input type="text" id="emprestimosLP_p4" class="input-valor"></td>
                                </tr>

                                <!-- 4.2 Financiamentos Imobili√°rios -->
                                <tr class="conta-row">
                                    <td>4.2 Financiamentos Imobili√°rios</td>
                                    <td><input type="text" id="financiamentosImobiliarios_p1" class="input-valor"></td>
                                    <td><input type="text" id="financiamentosImobiliarios_p2" class="input-valor"></td>
                                    <td><input type="text" id="financiamentosImobiliarios_p3" class="input-valor"></td>
                                    <td><input type="text" id="financiamentosImobiliarios_p4" class="input-valor"></td>
                                </tr>

                                <!-- 4.3 Deb√™ntures -->
                                <tr class="conta-row">
                                    <td>4.3 Deb√™ntures</td>
                                    <td><input type="text" id="debentures_p1" class="input-valor"></td>
                                    <td><input type="text" id="debentures_p2" class="input-valor"></td>
                                    <td><input type="text" id="debentures_p3" class="input-valor"></td>
                                    <td><input type="text" id="debentures_p4" class="input-valor"></td>
                                </tr>

                                <!-- 4.4 Provis√µes Trabalhistas -->
                                <tr class="conta-row">
                                    <td>4.4 Provis√µes Trabalhistas</td>
                                    <td><input type="text" id="provisoesTrabalhistas_p1" class="input-valor"></td>
                                    <td><input type="text" id="provisoesTrabalhistas_p2" class="input-valor"></td>
                                    <td><input type="text" id="provisoesTrabalhistas_p3" class="input-valor"></td>
                                    <td><input type="text" id="provisoesTrabalhistas_p4" class="input-valor"></td>
                                </tr>

                                <!-- 4.5 Provis√µes Fiscais -->
                                <tr class="conta-row">
                                    <td>4.5 Provis√µes Fiscais</td>
                                    <td><input type="text" id="provisoesFiscais_p1" class="input-valor"></td>
                                    <td><input type="text" id="provisoesFiscais_p2" class="input-valor"></td>
                                    <td><input type="text" id="provisoesFiscais_p3" class="input-valor"></td>
                                    <td><input type="text" id="provisoesFiscais_p4" class="input-valor"></td>
                                </tr>

                                <!-- 4.6 Outros Passivos N√£o Circulantes -->
                                <tr class="conta-row">
                                    <td>4.6 Outros Passivos N√£o Circulantes</td>
                                    <td><input type="text" id="outrosPNC_p1" class="input-valor"></td>
                                    <td><input type="text" id="outrosPNC_p2" class="input-valor"></td>
                                    <td><input type="text" id="outrosPNC_p3" class="input-valor"></td>
                                    <td><input type="text" id="outrosPNC_p4" class="input-valor"></td>
                                </tr>

                                <!-- SUBTOTAL PASSIVO N√ÉO CIRCULANTE -->
                                <tr class="subtotal-row">
                                    <td>SUBTOTAL PASSIVO N√ÉO CIRCULANTE</td>
                                    <td class="subtotal-valor" id="passivoNaoCirculanteTotal_p1">-</td>
                                    <td class="subtotal-valor" id="passivoNaoCirculanteTotal_p2">-</td>
                                    <td class="subtotal-valor" id="passivoNaoCirculanteTotal_p3">-</td>
                                    <td class="subtotal-valor" id="passivoNaoCirculanteTotal_p4">-</td>
                                </tr>

                                <!-- ========== 5. PATRIM√îNIO L√çQUIDO (6 contas) ========== -->
                                <tr class="subcategoria-level1 patrimonio">
                                    <td>5. PATRIM√îNIO L√çQUIDO</td>
                                    <td colspan="4"></td>
                                </tr>

                                <!-- 5.1 Capital Social -->
                                <tr class="conta-row">
                                    <td>5.1 Capital Social</td>
                                    <td><input type="text" id="capitalSocial_p1" class="input-valor"></td>
                                    <td><input type="text" id="capitalSocial_p2" class="input-valor"></td>
                                    <td><input type="text" id="capitalSocial_p3" class="input-valor"></td>
                                    <td><input type="text" id="capitalSocial_p4" class="input-valor"></td>
                                </tr>

                                <!-- 5.2 Reserva de Capital -->
                                <tr class="conta-row">
                                    <td>5.2 Reserva de Capital</td>
                                    <td><input type="text" id="reservaCapital_p1" class="input-valor"></td>
                                    <td><input type="text" id="reservaCapital_p2" class="input-valor"></td>
                                    <td><input type="text" id="reservaCapital_p3" class="input-valor"></td>
                                    <td><input type="text" id="reservaCapital_p4" class="input-valor"></td>
                                </tr>

                                <!-- 5.3 Reserva de Lucros -->
                                <tr class="conta-row">
                                    <td>5.3 Reserva de Lucros</td>
                                    <td><input type="text" id="reservaLucros_p1" class="input-valor"></td>
                                    <td><input type="text" id="reservaLucros_p2" class="input-valor"></td>
                                    <td><input type="text" id="reservaLucros_p3" class="input-valor"></td>
                                    <td><input type="text" id="reservaLucros_p4" class="input-valor"></td>
                                </tr>

                                <!-- 5.4 Reserva Legal -->
                                <tr class="conta-row">
                                    <td>5.4 Reserva Legal</td>
                                    <td><input type="text" id="reservaLegal_p1" class="input-valor"></td>
                                    <td><input type="text" id="reservaLegal_p2" class="input-valor"></td>
                                    <td><input type="text" id="reservaLegal_p3" class="input-valor"></td>
                                    <td><input type="text" id="reservaLegal_p4" class="input-valor"></td>
                                </tr>

                                <!-- 5.5 Lucros/Preju√≠zos Acumulados -->
                                <tr class="conta-row">
                                    <td>5.5 Lucros/Preju√≠zos Acumulados</td>
                                    <td><input type="text" id="lucrosPrejuizosAcumulados_p1" class="input-valor"></td>
                                    <td><input type="text" id="lucrosPrejuizosAcumulados_p2" class="input-valor"></td>
                                    <td><input type="text" id="lucrosPrejuizosAcumulados_p3" class="input-valor"></td>
                                    <td><input type="text" id="lucrosPrejuizosAcumulados_p4" class="input-valor"></td>
                                </tr>

                                <!-- 5.6 Ajustes de Avalia√ß√£o Patrimonial -->
                                <tr class="conta-row">
                                    <td>5.6 Ajustes de Avalia√ß√£o Patrimonial</td>
                                    <td><input type="text" id="ajustesAvaliacaoPatrimonial_p1" class="input-valor"></td>
                                    <td><input type="text" id="ajustesAvaliacaoPatrimonial_p2" class="input-valor"></td>
                                    <td><input type="text" id="ajustesAvaliacaoPatrimonial_p3" class="input-valor"></td>
                                    <td><input type="text" id="ajustesAvaliacaoPatrimonial_p4" class="input-valor"></td>
                                </tr>

                                <!-- 5.7 (-) A√ß√µes em Tesouraria -->
                                <tr class="conta-row last-in-group negative-account">
                                    <td>5.7 (-) A√ß√µes em Tesouraria</td>
                                    <td><input type="text" id="acoesTesouraria_p1" class="input-valor"></td>
                                    <td><input type="text" id="acoesTesouraria_p2" class="input-valor"></td>
                                    <td><input type="text" id="acoesTesouraria_p3" class="input-valor"></td>
                                    <td><input type="text" id="acoesTesouraria_p4" class="input-valor"></td>
                                </tr>

                                <!-- SUBTOTAL PATRIM√îNIO L√çQUIDO -->
                                <tr class="subtotal-row">
                                    <td>SUBTOTAL PATRIM√îNIO L√çQUIDO</td>
                                    <td class="subtotal-valor" id="patrimonioLiquidoTotal_p1">-</td>
                                    <td class="subtotal-valor" id="patrimonioLiquidoTotal_p2">-</td>
                                    <td class="subtotal-valor" id="patrimonioLiquidoTotal_p3">-</td>
                                    <td class="subtotal-valor" id="patrimonioLiquidoTotal_p4">-</td>
                                </tr>

                                <!-- TOTAL PASSIVO + PL -->
                                <tr class="total-row">
                                    <td>TOTAL PASSIVO + PATRIM√îNIO L√çQUIDO</td>
                                    <td class="total-valor" id="totalPassivoPL_p1">-</td>
                                    <td class="total-valor" id="totalPassivoPL_p2">-</td>
                                    <td class="total-valor" id="totalPassivoPL_p3">-</td>
                                    <td class="total-valor" id="totalPassivoPL_p4">-</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <!-- Legenda de Valida√ß√£o -->
                    <div style="background: #f8f9fa; padding: 1rem; border-radius: 4px; margin-bottom: 2rem;">
                        <p style="margin: 0; color: #666; font-size: 0.875rem;">
                            <strong>Legenda de Valida√ß√£o:</strong>
                            ‚úÖ Equilibrado (Ativo = Passivo + PL) |
                            ‚ùå Desbalanceado |
                            ‚ö™ Dados Insuficientes
                        </p>
                    </div>

                    <!-- Mensagem Informativa sobre C√°lculos Autom√°ticos -->
                    <div class="info-box info-box-primary">
                        <svg class="info-box-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                        </svg>
                        <div class="info-box-content">
                            <strong class="info-box-title">C√°lculos Autom√°ticos Ativados</strong>
                            <p class="info-box-text">
                                Os √≠ndices financeiros e scoring ser√£o calculados automaticamente ao navegar para as abas
                                <strong>"√çndices Financeiros"</strong> ou <strong>"Scoring"</strong>.
                                N√£o √© necess√°rio acionar nenhum bot√£o de c√°lculo nesta aba.
                            </p>
                            <p class="info-box-tip">
                                üí° Dica: Preencha todos os dados necess√°rios e depois navegue para visualizar os resultados atualizados.
                            </p>
                        </div>
                    </div>

                    <!-- Bot√µes de A√ß√£o -->
                    <div class="acoes-balanco">
                        <button id="btnImportarExcel" class="btn btn-secondary">üì• Importar Excel/JSON</button>
                        <button id="btnExportar" class="btn btn-secondary">üì§ Exportar JSON</button>
                    </div>

                    <!-- Tabs de An√°lises -->
                    <div class="analises-container">
                        <div class="tabs-header">
                            <button class="tab-btn active" data-tab="analise-horizontal">An√°lise Horizontal</button>
                            <button class="tab-btn" data-tab="analise-vertical">An√°lise Vertical</button>
                            <button class="tab-btn" data-tab="indicadores">Indicadores</button>
                            <button class="tab-btn" data-tab="graficos">Gr√°ficos</button>
                        </div>

                        <!-- Tab: An√°lise Horizontal -->
                        <div id="analise-horizontal" class="tab-content active">
                            <div id="tabelaAnaliseHorizontal" class="empty-state">
                                <p>‚è≥ Aguardando preenchimento das demonstra√ß√µes financeiras...</p>
                            </div>
                        </div>

                        <!-- Tab: An√°lise Vertical -->
                        <div id="analise-vertical" class="tab-content">
                            <div id="tabelaAnaliseVertical" class="empty-state">
                                <p>‚è≥ Aguardando preenchimento das demonstra√ß√µes financeiras...</p>
                            </div>
                        </div>

                        <!-- Tab: Indicadores -->
                        <div id="indicadores" class="tab-content">
                            <div id="tabelaIndicadores" class="empty-state">
                                <p>‚è≥ Aguardando preenchimento das demonstra√ß√µes financeiras...</p>
                            </div>
                        </div>

                        <!-- Tab: Gr√°ficos -->
                        <div id="graficos" class="tab-content">
                            <div id="containerGraficos" class="empty-state">
                                <p>‚è≥ Aguardando preenchimento das demonstra√ß√µes financeiras...</p>
                            </div>
                        </div>
                    </div>

                    <hr style="margin: 3rem 0; border: 0; border-top: 2px solid #e0e0e0;">

                    <!-- =========================================== -->
                    <!-- DRE - DEMONSTRA√á√ÉO DO RESULTADO             -->
                    <!-- =========================================== -->
                    <h3 style="color: #091A30; margin-bottom: 1.5rem;">üìà Demonstra√ß√£o do Resultado do Exerc√≠cio (DRE)</h3>

                    <!-- INSTRU√á√ïES -->
                    <div class="alert alert-info" style="margin-bottom: 2rem; padding: 1rem; background: #e3f2fd; border-left: 4px solid #2196f3; border-radius: 4px;">
                        <strong>üìã Instru√ß√µes:</strong> Preencha as DREs hist√≥ricas de 3 anos completos + 1 per√≠odo parcial (se aplic√°vel).
                        Todos os valores monet√°rios devem ser em <strong>R$ (Reais)</strong>.
                        Marque o checkbox "Per√≠odo Parcial" e informe os meses decorridos (1-11) caso aplic√°vel.
                    </div>

                    <!-- CONFIGURA√á√ÉO DOS PER√çODOS -->
                    <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 1rem; margin-bottom: 2rem;">
                        <div class="form-group">
                            <label for="dre-periodo1-data">Per√≠odo 1 - Data (AAAA-MM-DD)</label>
                            <input type="date" id="dre-periodo1-data" class="form-control" value="2022-12-31" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                        </div>
                        <div class="form-group">
                            <label for="dre-periodo2-data">Per√≠odo 2 - Data (AAAA-MM-DD)</label>
                            <input type="date" id="dre-periodo2-data" class="form-control" value="2023-12-31" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                        </div>
                        <div class="form-group">
                            <label for="dre-periodo3-data">Per√≠odo 3 - Data (AAAA-MM-DD)</label>
                            <input type="date" id="dre-periodo3-data" class="form-control" value="2024-12-31" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                        </div>
                        <div class="form-group">
                            <label for="dre-periodo4-data">Per√≠odo 4 - Data (AAAA-MM-DD)</label>
                            <input type="date" id="dre-periodo4-data" class="form-control" value="2025-09-30" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                        </div>
                    </div>

                    <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 1rem; margin-bottom: 2rem;">
                        <div class="form-group"></div>
                        <div class="form-group"></div>
                        <div class="form-group"></div>
                        <div class="form-group">
                            <label style="display: flex; align-items: center; margin-bottom: 0.5rem;">
                                <input type="checkbox" id="dre-periodo4-parcial" style="margin-right: 0.5rem;">
                                <span>Per√≠odo 4 √© parcial</span>
                            </label>
                            <label for="dre-periodo4-meses" style="margin-top: 0.5rem;">Meses Decorridos (1-11)</label>
                            <input type="number" id="dre-periodo4-meses" class="form-control" min="1" max="11" value="9" disabled style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                        </div>
                    </div>

                    <!-- TABELA MATRICIAL DRE (30 contas √ó 4 per√≠odos) -->
                    <div class="dre-container">
                        <table class="dre-cronologico">
                            <thead>
                                <tr>
                                    <th>CONTA</th>
                                    <th>Per√≠odo 1</th>
                                    <th>Per√≠odo 2</th>
                                    <th>Per√≠odo 3</th>
                                    <th>Per√≠odo 4</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- GRUPO: RECEITA BRUTA -->
                                <tr class="grupo-header">
                                    <td colspan="5"><strong>RECEITA BRUTA</strong></td>
                                </tr>
                                <tr class="conta-row">
                                    <td>Vendas de Produtos</td>
                                    <td><input type="text" id="vendasProdutos_p1" name="vendasProdutos_p1" class="input-valor" data-conta="vendasProdutos" data-periodo="1"></td>
                                    <td><input type="text" id="vendasProdutos_p2" name="vendasProdutos_p2" class="input-valor" data-conta="vendasProdutos" data-periodo="2"></td>
                                    <td><input type="text" id="vendasProdutos_p3" name="vendasProdutos_p3" class="input-valor" data-conta="vendasProdutos" data-periodo="3"></td>
                                    <td><input type="text" id="vendasProdutos_p4" name="vendasProdutos_p4" class="input-valor" data-conta="vendasProdutos" data-periodo="4"></td>
                                </tr>
                                <tr class="conta-row">
                                    <td>Vendas de Servi√ßos</td>
                                    <td><input type="text" id="vendasServicos_p1" name="vendasServicos_p1" class="input-valor" data-conta="vendasServicos" data-periodo="1"></td>
                                    <td><input type="text" id="vendasServicos_p2" name="vendasServicos_p2" class="input-valor" data-conta="vendasServicos" data-periodo="2"></td>
                                    <td><input type="text" id="vendasServicos_p3" name="vendasServicos_p3" class="input-valor" data-conta="vendasServicos" data-periodo="3"></td>
                                    <td><input type="text" id="vendasServicos_p4" name="vendasServicos_p4" class="input-valor" data-conta="vendasServicos" data-periodo="4"></td>
                                </tr>
                                <tr class="conta-row last-in-group">
                                    <td>Outras Receitas Operacionais</td>
                                    <td><input type="text" id="outrasReceitas_p1" name="outrasReceitas_p1" class="input-valor" data-conta="outrasReceitas" data-periodo="1"></td>
                                    <td><input type="text" id="outrasReceitas_p2" name="outrasReceitas_p2" class="input-valor" data-conta="outrasReceitas" data-periodo="2"></td>
                                    <td><input type="text" id="outrasReceitas_p3" name="outrasReceitas_p3" class="input-valor" data-conta="outrasReceitas" data-periodo="3"></td>
                                    <td><input type="text" id="outrasReceitas_p4" name="outrasReceitas_p4" class="input-valor" data-conta="outrasReceitas" data-periodo="4"></td>
                                </tr>
                                <tr class="subtotal-row">
                                    <td>TOTAL RECEITA BRUTA</td>
                                    <td class="subtotal-valor" data-total="receitaBrutaTotal" data-periodo="1">R$ 0,00</td>
                                    <td class="subtotal-valor" data-total="receitaBrutaTotal" data-periodo="2">R$ 0,00</td>
                                    <td class="subtotal-valor" data-total="receitaBrutaTotal" data-periodo="3">R$ 0,00</td>
                                    <td class="subtotal-valor" data-total="receitaBrutaTotal" data-periodo="4">R$ 0,00</td>
                                </tr>

                                <!-- GRUPO: DEDU√á√ïES DA RECEITA -->
                                <tr class="grupo-header">
                                    <td colspan="5"><strong>DEDU√á√ïES DA RECEITA</strong></td>
                                </tr>
                                <tr class="conta-row negative-account">
                                    <td>(-) ICMS sobre Vendas</td>
                                    <td><input type="text" id="icms_p1" name="icms_p1" class="input-valor" data-conta="icms" data-periodo="1"></td>
                                    <td><input type="text" id="icms_p2" name="icms_p2" class="input-valor" data-conta="icms" data-periodo="2"></td>
                                    <td><input type="text" id="icms_p3" name="icms_p3" class="input-valor" data-conta="icms" data-periodo="3"></td>
                                    <td><input type="text" id="icms_p4" name="icms_p4" class="input-valor" data-conta="icms" data-periodo="4"></td>
                                </tr>
                                <tr class="conta-row negative-account">
                                    <td>(-) PIS sobre Vendas</td>
                                    <td><input type="text" id="pis_p1" name="pis_p1" class="input-valor" data-conta="pis" data-periodo="1"></td>
                                    <td><input type="text" id="pis_p2" name="pis_p2" class="input-valor" data-conta="pis" data-periodo="2"></td>
                                    <td><input type="text" id="pis_p3" name="pis_p3" class="input-valor" data-conta="pis" data-periodo="3"></td>
                                    <td><input type="text" id="pis_p4" name="pis_p4" class="input-valor" data-conta="pis" data-periodo="4"></td>
                                </tr>
                                <tr class="conta-row negative-account">
                                    <td>(-) COFINS sobre Vendas</td>
                                    <td><input type="text" id="cofins_p1" name="cofins_p1" class="input-valor" data-conta="cofins" data-periodo="1"></td>
                                    <td><input type="text" id="cofins_p2" name="cofins_p2" class="input-valor" data-conta="cofins" data-periodo="2"></td>
                                    <td><input type="text" id="cofins_p3" name="cofins_p3" class="input-valor" data-conta="cofins" data-periodo="3"></td>
                                    <td><input type="text" id="cofins_p4" name="cofins_p4" class="input-valor" data-conta="cofins" data-periodo="4"></td>
                                </tr>
                                <tr class="conta-row negative-account">
                                    <td>(-) ISS sobre Servi√ßos</td>
                                    <td><input type="text" id="iss_p1" name="iss_p1" class="input-valor" data-conta="iss" data-periodo="1"></td>
                                    <td><input type="text" id="iss_p2" name="iss_p2" class="input-valor" data-conta="iss" data-periodo="2"></td>
                                    <td><input type="text" id="iss_p3" name="iss_p3" class="input-valor" data-conta="iss" data-periodo="3"></td>
                                    <td><input type="text" id="iss_p4" name="iss_p4" class="input-valor" data-conta="iss" data-periodo="4"></td>
                                </tr>
                                <tr class="conta-row negative-account">
                                    <td>(-) Devolu√ß√µes e Cancelamentos</td>
                                    <td><input type="text" id="devolucoesVendas_p1" name="devolucoesVendas_p1" class="input-valor" data-conta="devolucoesVendas" data-periodo="1"></td>
                                    <td><input type="text" id="devolucoesVendas_p2" name="devolucoesVendas_p2" class="input-valor" data-conta="devolucoesVendas" data-periodo="2"></td>
                                    <td><input type="text" id="devolucoesVendas_p3" name="devolucoesVendas_p3" class="input-valor" data-conta="devolucoesVendas" data-periodo="3"></td>
                                    <td><input type="text" id="devolucoesVendas_p4" name="devolucoesVendas_p4" class="input-valor" data-conta="devolucoesVendas" data-periodo="4"></td>
                                </tr>
                                <tr class="conta-row negative-account last-in-group">
                                    <td>(-) Abatimentos Concedidos</td>
                                    <td><input type="text" id="abatimentos_p1" name="abatimentos_p1" class="input-valor" data-conta="abatimentos" data-periodo="1"></td>
                                    <td><input type="text" id="abatimentos_p2" name="abatimentos_p2" class="input-valor" data-conta="abatimentos" data-periodo="2"></td>
                                    <td><input type="text" id="abatimentos_p3" name="abatimentos_p3" class="input-valor" data-conta="abatimentos" data-periodo="3"></td>
                                    <td><input type="text" id="abatimentos_p4" name="abatimentos_p4" class="input-valor" data-conta="abatimentos" data-periodo="4"></td>
                                </tr>
                                <tr class="subtotal-row">
                                    <td>TOTAL DEDU√á√ïES</td>
                                    <td class="subtotal-valor" data-total="deducoesTotal" data-periodo="1">R$ 0,00</td>
                                    <td class="subtotal-valor" data-total="deducoesTotal" data-periodo="2">R$ 0,00</td>
                                    <td class="subtotal-valor" data-total="deducoesTotal" data-periodo="3">R$ 0,00</td>
                                    <td class="subtotal-valor" data-total="deducoesTotal" data-periodo="4">R$ 0,00</td>
                                </tr>

                                <!-- TOTAL: RECEITA L√çQUIDA -->
                                <tr class="total-row">
                                    <td>RECEITA OPERACIONAL L√çQUIDA</td>
                                    <td class="total-valor" data-total="receitaLiquida" data-periodo="1">R$ 0,00</td>
                                    <td class="total-valor" data-total="receitaLiquida" data-periodo="2">R$ 0,00</td>
                                    <td class="total-valor" data-total="receitaLiquida" data-periodo="3">R$ 0,00</td>
                                    <td class="total-valor" data-total="receitaLiquida" data-periodo="4">R$ 0,00</td>
                                </tr>

                                <!-- GRUPO: CUSTOS OPERACIONAIS -->
                                <tr class="grupo-header">
                                    <td colspan="5"><strong>CUSTOS OPERACIONAIS</strong></td>
                                </tr>
                                <tr class="conta-row negative-account">
                                    <td>(-) CMV / CPV</td>
                                    <td><input type="text" id="materiaPrima_p1" name="materiaPrima_p1" class="input-valor" data-conta="materiaPrima" data-periodo="1"></td>
                                    <td><input type="text" id="materiaPrima_p2" name="materiaPrima_p2" class="input-valor" data-conta="materiaPrima" data-periodo="2"></td>
                                    <td><input type="text" id="materiaPrima_p3" name="materiaPrima_p3" class="input-valor" data-conta="materiaPrima" data-periodo="3"></td>
                                    <td><input type="text" id="materiaPrima_p4" name="materiaPrima_p4" class="input-valor" data-conta="materiaPrima" data-periodo="4"></td>
                                </tr>
                                <tr class="conta-row negative-account">
                                    <td>(-) Custos dos Servi√ßos Prestados</td>
                                    <td><input type="text" id="embalagens_p1" name="embalagens_p1" class="input-valor" data-conta="embalagens" data-periodo="1"></td>
                                    <td><input type="text" id="embalagens_p2" name="embalagens_p2" class="input-valor" data-conta="embalagens" data-periodo="2"></td>
                                    <td><input type="text" id="embalagens_p3" name="embalagens_p3" class="input-valor" data-conta="embalagens" data-periodo="3"></td>
                                    <td><input type="text" id="embalagens_p4" name="embalagens_p4" class="input-valor" data-conta="embalagens" data-periodo="4"></td>
                                </tr>
                                <tr class="conta-row negative-account">
                                    <td>(-) M√£o-de-Obra de Produ√ß√£o</td>
                                    <td><input type="text" id="maoObraDireta_p1" name="maoObraDireta_p1" class="input-valor" data-conta="maoObraDireta" data-periodo="1"></td>
                                    <td><input type="text" id="maoObraDireta_p2" name="maoObraDireta_p2" class="input-valor" data-conta="maoObraDireta" data-periodo="2"></td>
                                    <td><input type="text" id="maoObraDireta_p3" name="maoObraDireta_p3" class="input-valor" data-conta="maoObraDireta" data-periodo="3"></td>
                                    <td><input type="text" id="maoObraDireta_p4" name="maoObraDireta_p4" class="input-valor" data-conta="maoObraDireta" data-periodo="4"></td>
                                </tr>
                                <tr class="conta-row negative-account">
                                    <td>(-) Terceiriza√ß√£o de Produ√ß√£o</td>
                                    <td><input type="text" id="terceirizacaoProducao_p1" name="terceirizacaoProducao_p1" class="input-valor" data-conta="terceirizacaoProducao" data-periodo="1"></td>
                                    <td><input type="text" id="terceirizacaoProducao_p2" name="terceirizacaoProducao_p2" class="input-valor" data-conta="terceirizacaoProducao" data-periodo="2"></td>
                                    <td><input type="text" id="terceirizacaoProducao_p3" name="terceirizacaoProducao_p3" class="input-valor" data-conta="terceirizacaoProducao" data-periodo="3"></td>
                                    <td><input type="text" id="terceirizacaoProducao_p4" name="terceirizacaoProducao_p4" class="input-valor" data-conta="terceirizacaoProducao" data-periodo="4"></td>
                                </tr>
                                <tr class="conta-row negative-account last-in-group">
                                    <td>(-) Outros Custos Vari√°veis</td>
                                    <td><input type="text" id="outrosCustosVariaveis_p1" name="outrosCustosVariaveis_p1" class="input-valor" data-conta="outrosCustosVariaveis" data-periodo="1"></td>
                                    <td><input type="text" id="outrosCustosVariaveis_p2" name="outrosCustosVariaveis_p2" class="input-valor" data-conta="outrosCustosVariaveis" data-periodo="2"></td>
                                    <td><input type="text" id="outrosCustosVariaveis_p3" name="outrosCustosVariaveis_p3" class="input-valor" data-conta="outrosCustosVariaveis" data-periodo="3"></td>
                                    <td><input type="text" id="outrosCustosVariaveis_p4" name="outrosCustosVariaveis_p4" class="input-valor" data-conta="outrosCustosVariaveis" data-periodo="4"></td>
                                </tr>
                                <tr class="subtotal-row">
                                    <td>TOTAL CUSTOS OPERACIONAIS</td>
                                    <td class="subtotal-valor" data-total="custosTotal" data-periodo="1">R$ 0,00</td>
                                    <td class="subtotal-valor" data-total="custosTotal" data-periodo="2">R$ 0,00</td>
                                    <td class="subtotal-valor" data-total="custosTotal" data-periodo="3">R$ 0,00</td>
                                    <td class="subtotal-valor" data-total="custosTotal" data-periodo="4">R$ 0,00</td>
                                </tr>

                                <!-- TOTAL: LUCRO BRUTO -->
                                <tr class="total-row">
                                    <td>LUCRO BRUTO</td>
                                    <td class="total-valor" data-total="lucroBruto" data-periodo="1">R$ 0,00</td>
                                    <td class="total-valor" data-total="lucroBruto" data-periodo="2">R$ 0,00</td>
                                    <td class="total-valor" data-total="lucroBruto" data-periodo="3">R$ 0,00</td>
                                    <td class="total-valor" data-total="lucroBruto" data-periodo="4">R$ 0,00</td>
                                </tr>
                                <tr class="subtotal-row">
                                    <td>Margem Bruta (%)</td>
                                    <td class="subtotal-valor" data-total="margemBruta" data-periodo="1">0,00%</td>
                                    <td class="subtotal-valor" data-total="margemBruta" data-periodo="2">0,00%</td>
                                    <td class="subtotal-valor" data-total="margemBruta" data-periodo="3">0,00%</td>
                                    <td class="subtotal-valor" data-total="margemBruta" data-periodo="4">0,00%</td>
                                </tr>

                                <!-- GRUPO: DESPESAS DE VENDAS -->
                                <tr class="grupo-header">
                                    <td colspan="5"><strong>DESPESAS COM VENDAS</strong></td>
                                </tr>
                                <tr class="conta-row negative-account">
                                    <td>(-) Comiss√µes sobre Vendas</td>
                                    <td><input type="text" id="comissoes_p1" name="comissoes_p1" class="input-valor" data-conta="comissoes" data-periodo="1"></td>
                                    <td><input type="text" id="comissoes_p2" name="comissoes_p2" class="input-valor" data-conta="comissoes" data-periodo="2"></td>
                                    <td><input type="text" id="comissoes_p3" name="comissoes_p3" class="input-valor" data-conta="comissoes" data-periodo="3"></td>
                                    <td><input type="text" id="comissoes_p4" name="comissoes_p4" class="input-valor" data-conta="comissoes" data-periodo="4"></td>
                                </tr>
                                <tr class="conta-row negative-account">
                                    <td>(-) Marketing e Publicidade</td>
                                    <td><input type="text" id="vendasMarketing_p1" name="vendasMarketing_p1" class="input-valor" data-conta="vendasMarketing" data-periodo="1"></td>
                                    <td><input type="text" id="vendasMarketing_p2" name="vendasMarketing_p2" class="input-valor" data-conta="vendasMarketing" data-periodo="2"></td>
                                    <td><input type="text" id="vendasMarketing_p3" name="vendasMarketing_p3" class="input-valor" data-conta="vendasMarketing" data-periodo="3"></td>
                                    <td><input type="text" id="vendasMarketing_p4" name="vendasMarketing_p4" class="input-valor" data-conta="vendasMarketing" data-periodo="4"></td>
                                </tr>
                                <tr class="conta-row negative-account">
                                    <td>(-) Fretes e Entregas</td>
                                    <td><input type="text" id="frete_p1" name="frete_p1" class="input-valor" data-conta="frete" data-periodo="1"></td>
                                    <td><input type="text" id="frete_p2" name="frete_p2" class="input-valor" data-conta="frete" data-periodo="2"></td>
                                    <td><input type="text" id="frete_p3" name="frete_p3" class="input-valor" data-conta="frete" data-periodo="3"></td>
                                    <td><input type="text" id="frete_p4" name="frete_p4" class="input-valor" data-conta="frete" data-periodo="4"></td>
                                </tr>
                                <tr class="conta-row negative-account last-in-group">
                                    <td>(-) Outras Despesas de Vendas</td>
                                    <td><input type="text" id="outrasDespVendas_p1" name="outrasDespVendas_p1" class="input-valor" data-conta="outrasDespVendas" data-periodo="1"></td>
                                    <td><input type="text" id="outrasDespVendas_p2" name="outrasDespVendas_p2" class="input-valor" data-conta="outrasDespVendas" data-periodo="2"></td>
                                    <td><input type="text" id="outrasDespVendas_p3" name="outrasDespVendas_p3" class="input-valor" data-conta="outrasDespVendas" data-periodo="3"></td>
                                    <td><input type="text" id="outrasDespVendas_p4" name="outrasDespVendas_p4" class="input-valor" data-conta="outrasDespVendas" data-periodo="4"></td>
                                </tr>
                                <tr class="subtotal-row">
                                    <td>Subtotal Despesas de Vendas</td>
                                    <td class="subtotal-valor" data-total="despesasVendasTotal" data-periodo="1">R$ 0,00</td>
                                    <td class="subtotal-valor" data-total="despesasVendasTotal" data-periodo="2">R$ 0,00</td>
                                    <td class="subtotal-valor" data-total="despesasVendasTotal" data-periodo="3">R$ 0,00</td>
                                    <td class="subtotal-valor" data-total="despesasVendasTotal" data-periodo="4">R$ 0,00</td>
                                </tr>

                                <!-- GRUPO: DESPESAS ADMINISTRATIVAS -->
                                <tr class="grupo-header">
                                    <td colspan="5"><strong>DESPESAS ADMINISTRATIVAS</strong></td>
                                </tr>
                                <tr class="conta-row negative-account">
                                    <td>(-) Sal√°rios Administrativos</td>
                                    <td><input type="text" id="pessoal_p1" name="pessoal_p1" class="input-valor" data-conta="pessoal" data-periodo="1"></td>
                                    <td><input type="text" id="pessoal_p2" name="pessoal_p2" class="input-valor" data-conta="pessoal" data-periodo="2"></td>
                                    <td><input type="text" id="pessoal_p3" name="pessoal_p3" class="input-valor" data-conta="pessoal" data-periodo="3"></td>
                                    <td><input type="text" id="pessoal_p4" name="pessoal_p4" class="input-valor" data-conta="pessoal" data-periodo="4"></td>
                                </tr>
                                <tr class="conta-row negative-account">
                                    <td>(-) Alugu√©is e Condom√≠nios</td>
                                    <td><input type="text" id="alugueis_p1" name="alugueis_p1" class="input-valor" data-conta="alugueis" data-periodo="1"></td>
                                    <td><input type="text" id="alugueis_p2" name="alugueis_p2" class="input-valor" data-conta="alugueis" data-periodo="2"></td>
                                    <td><input type="text" id="alugueis_p3" name="alugueis_p3" class="input-valor" data-conta="alugueis" data-periodo="3"></td>
                                    <td><input type="text" id="alugueis_p4" name="alugueis_p4" class="input-valor" data-conta="alugueis" data-periodo="4"></td>
                                </tr>
                                <tr class="conta-row negative-account">
                                    <td>(-) Utilidades (√Ågua, Luz, Telecom)</td>
                                    <td><input type="text" id="utilidades_p1" name="utilidades_p1" class="input-valor" data-conta="utilidades" data-periodo="1"></td>
                                    <td><input type="text" id="utilidades_p2" name="utilidades_p2" class="input-valor" data-conta="utilidades" data-periodo="2"></td>
                                    <td><input type="text" id="utilidades_p3" name="utilidades_p3" class="input-valor" data-conta="utilidades" data-periodo="3"></td>
                                    <td><input type="text" id="utilidades_p4" name="utilidades_p4" class="input-valor" data-conta="utilidades" data-periodo="4"></td>
                                </tr>
                                <tr class="conta-row negative-account">
                                    <td>(-) Seguros</td>
                                    <td><input type="text" id="seguros_p1" name="seguros_p1" class="input-valor" data-conta="seguros" data-periodo="1"></td>
                                    <td><input type="text" id="seguros_p2" name="seguros_p2" class="input-valor" data-conta="seguros" data-periodo="2"></td>
                                    <td><input type="text" id="seguros_p3" name="seguros_p3" class="input-valor" data-conta="seguros" data-periodo="3"></td>
                                    <td><input type="text" id="seguros_p4" name="seguros_p4" class="input-valor" data-conta="seguros" data-periodo="4"></td>
                                </tr>
                                <tr class="conta-row negative-account">
                                    <td>(-) Manuten√ß√£o e Reparos</td>
                                    <td><input type="text" id="manutencao_p1" name="manutencao_p1" class="input-valor" data-conta="manutencao" data-periodo="1"></td>
                                    <td><input type="text" id="manutencao_p2" name="manutencao_p2" class="input-valor" data-conta="manutencao" data-periodo="2"></td>
                                    <td><input type="text" id="manutencao_p3" name="manutencao_p3" class="input-valor" data-conta="manutencao" data-periodo="3"></td>
                                    <td><input type="text" id="manutencao_p4" name="manutencao_p4" class="input-valor" data-conta="manutencao" data-periodo="4"></td>
                                </tr>
                                <tr class="conta-row negative-account">
                                    <td>(-) Tecnologia da Informa√ß√£o</td>
                                    <td><input type="text" id="tecnologiaInformacao_p1" name="tecnologiaInformacao_p1" class="input-valor" data-conta="tecnologiaInformacao" data-periodo="1"></td>
                                    <td><input type="text" id="tecnologiaInformacao_p2" name="tecnologiaInformacao_p2" class="input-valor" data-conta="tecnologiaInformacao" data-periodo="2"></td>
                                    <td><input type="text" id="tecnologiaInformacao_p3" name="tecnologiaInformacao_p3" class="input-valor" data-conta="tecnologiaInformacao" data-periodo="3"></td>
                                    <td><input type="text" id="tecnologiaInformacao_p4" name="tecnologiaInformacao_p4" class="input-valor" data-conta="tecnologiaInformacao" data-periodo="4"></td>
                                </tr>
                                <tr class="conta-row negative-account">
                                    <td>(-) Servi√ßos de Terceiros</td>
                                    <td><input type="text" id="servicosProfissionais_p1" name="servicosProfissionais_p1" class="input-valor" data-conta="servicosProfissionais" data-periodo="1"></td>
                                    <td><input type="text" id="servicosProfissionais_p2" name="servicosProfissionais_p2" class="input-valor" data-conta="servicosProfissionais" data-periodo="2"></td>
                                    <td><input type="text" id="servicosProfissionais_p3" name="servicosProfissionais_p3" class="input-valor" data-conta="servicosProfissionais" data-periodo="3"></td>
                                    <td><input type="text" id="servicosProfissionais_p4" name="servicosProfissionais_p4" class="input-valor" data-conta="servicosProfissionais" data-periodo="4"></td>
                                </tr>
                                <tr class="conta-row negative-account last-in-group">
                                    <td>(-) Outras Despesas Administrativas</td>
                                    <td><input type="text" id="administrativas_p1" name="administrativas_p1" class="input-valor" data-conta="administrativas" data-periodo="1"></td>
                                    <td><input type="text" id="administrativas_p2" name="administrativas_p2" class="input-valor" data-conta="administrativas" data-periodo="2"></td>
                                    <td><input type="text" id="administrativas_p3" name="administrativas_p3" class="input-valor" data-conta="administrativas" data-periodo="3"></td>
                                    <td><input type="text" id="administrativas_p4" name="administrativas_p4" class="input-valor" data-conta="administrativas" data-periodo="4"></td>
                                </tr>
                                <tr class="subtotal-row">
                                    <td>Subtotal Despesas Administrativas</td>
                                    <td class="subtotal-valor" data-total="despesasAdminTotal" data-periodo="1">R$ 0,00</td>
                                    <td class="subtotal-valor" data-total="despesasAdminTotal" data-periodo="2">R$ 0,00</td>
                                    <td class="subtotal-valor" data-total="despesasAdminTotal" data-periodo="3">R$ 0,00</td>
                                    <td class="subtotal-valor" data-total="despesasAdminTotal" data-periodo="4">R$ 0,00</td>
                                </tr>

                                <!-- OUTRAS DESPESAS OPERACIONAIS -->
                                <tr class="conta-row negative-account last-in-group">
                                    <td>(-) Outras Despesas Operacionais</td>
                                    <td><input type="text" id="outrasDespesas_p1" name="outrasDespesas_p1" class="input-valor" data-conta="outrasDespesas" data-periodo="1"></td>
                                    <td><input type="text" id="outrasDespesas_p2" name="outrasDespesas_p2" class="input-valor" data-conta="outrasDespesas" data-periodo="2"></td>
                                    <td><input type="text" id="outrasDespesas_p3" name="outrasDespesas_p3" class="input-valor" data-conta="outrasDespesas" data-periodo="3"></td>
                                    <td><input type="text" id="outrasDespesas_p4" name="outrasDespesas_p4" class="input-valor" data-conta="outrasDespesas" data-periodo="4"></td>
                                </tr>
                                <tr class="subtotal-row">
                                    <td>TOTAL DESPESAS OPERACIONAIS</td>
                                    <td class="subtotal-valor" data-total="despesasOperacionaisTotal" data-periodo="1">R$ 0,00</td>
                                    <td class="subtotal-valor" data-total="despesasOperacionaisTotal" data-periodo="2">R$ 0,00</td>
                                    <td class="subtotal-valor" data-total="despesasOperacionaisTotal" data-periodo="3">R$ 0,00</td>
                                    <td class="subtotal-valor" data-total="despesasOperacionaisTotal" data-periodo="4">R$ 0,00</td>
                                </tr>

                                <!-- TOTAL: EBITDA -->
                                <tr class="total-row">
                                    <td>EBITDA</td>
                                    <td class="total-valor" data-total="ebitda" data-periodo="1">R$ 0,00</td>
                                    <td class="total-valor" data-total="ebitda" data-periodo="2">R$ 0,00</td>
                                    <td class="total-valor" data-total="ebitda" data-periodo="3">R$ 0,00</td>
                                    <td class="total-valor" data-total="ebitda" data-periodo="4">R$ 0,00</td>
                                </tr>
                                <tr class="subtotal-row">
                                    <td>Margem EBITDA (%)</td>
                                    <td class="subtotal-valor" data-total="margemEBITDA" data-periodo="1">0,00%</td>
                                    <td class="subtotal-valor" data-total="margemEBITDA" data-periodo="2">0,00%</td>
                                    <td class="subtotal-valor" data-total="margemEBITDA" data-periodo="3">0,00%</td>
                                    <td class="subtotal-valor" data-total="margemEBITDA" data-periodo="4">0,00%</td>
                                </tr>

                                <!-- GRUPO: DEPRECIA√á√ÉO E AMORTIZA√á√ÉO -->
                                <tr class="grupo-header">
                                    <td colspan="5"><strong>DEPRECIA√á√ÉO E AMORTIZA√á√ÉO</strong></td>
                                </tr>
                                <tr class="conta-row negative-account last-in-group">
                                    <td>(-) Deprecia√ß√£o e Amortiza√ß√£o</td>
                                    <td><input type="text" id="depreciacaoAmortizacao_p1" name="depreciacaoAmortizacao_p1" class="input-valor" data-conta="depreciacaoAmortizacao" data-periodo="1"></td>
                                    <td><input type="text" id="depreciacaoAmortizacao_p2" name="depreciacaoAmortizacao_p2" class="input-valor" data-conta="depreciacaoAmortizacao" data-periodo="2"></td>
                                    <td><input type="text" id="depreciacaoAmortizacao_p3" name="depreciacaoAmortizacao_p3" class="input-valor" data-conta="depreciacaoAmortizacao" data-periodo="3"></td>
                                    <td><input type="text" id="depreciacaoAmortizacao_p4" name="depreciacaoAmortizacao_p4" class="input-valor" data-conta="depreciacaoAmortizacao" data-periodo="4"></td>
                                </tr>
                                <tr class="subtotal-row">
                                    <td>Total Deprec. e Amortiz.</td>
                                    <td class="subtotal-valor" data-total="depreciacaoAmortizacaoTotal" data-periodo="1">R$ 0,00</td>
                                    <td class="subtotal-valor" data-total="depreciacaoAmortizacaoTotal" data-periodo="2">R$ 0,00</td>
                                    <td class="subtotal-valor" data-total="depreciacaoAmortizacaoTotal" data-periodo="3">R$ 0,00</td>
                                    <td class="subtotal-valor" data-total="depreciacaoAmortizacaoTotal" data-periodo="4">R$ 0,00</td>
                                </tr>

                                <!-- TOTAL: EBIT -->
                                <tr class="total-row">
                                    <td>EBIT (Lucro Operacional)</td>
                                    <td class="total-valor" data-total="ebit" data-periodo="1">R$ 0,00</td>
                                    <td class="total-valor" data-total="ebit" data-periodo="2">R$ 0,00</td>
                                    <td class="total-valor" data-total="ebit" data-periodo="3">R$ 0,00</td>
                                    <td class="total-valor" data-total="ebit" data-periodo="4">R$ 0,00</td>
                                </tr>
                                <tr class="subtotal-row">
                                    <td>Margem Operacional (%)</td>
                                    <td class="subtotal-valor" data-total="margemOperacional" data-periodo="1">0,00%</td>
                                    <td class="subtotal-valor" data-total="margemOperacional" data-periodo="2">0,00%</td>
                                    <td class="subtotal-valor" data-total="margemOperacional" data-periodo="3">0,00%</td>
                                    <td class="subtotal-valor" data-total="margemOperacional" data-periodo="4">0,00%</td>
                                </tr>

                                <!-- GRUPO: RESULTADO FINANCEIRO -->
                                <tr class="grupo-header">
                                    <td colspan="5"><strong>RESULTADO FINANCEIRO</strong></td>
                                </tr>
                                <tr class="conta-row">
                                    <td>(+) Receitas Financeiras</td>
                                    <td><input type="text" id="receitasFinanceiras_p1" name="receitasFinanceiras_p1" class="input-valor" data-conta="receitasFinanceiras" data-periodo="1"></td>
                                    <td><input type="text" id="receitasFinanceiras_p2" name="receitasFinanceiras_p2" class="input-valor" data-conta="receitasFinanceiras" data-periodo="2"></td>
                                    <td><input type="text" id="receitasFinanceiras_p3" name="receitasFinanceiras_p3" class="input-valor" data-conta="receitasFinanceiras" data-periodo="3"></td>
                                    <td><input type="text" id="receitasFinanceiras_p4" name="receitasFinanceiras_p4" class="input-valor" data-conta="receitasFinanceiras" data-periodo="4"></td>
                                </tr>
                                <tr class="conta-row negative-account last-in-group">
                                    <td>(-) Despesas Financeiras</td>
                                    <td><input type="text" id="despesasFinanceiras_p1" name="despesasFinanceiras_p1" class="input-valor" data-conta="despesasFinanceiras" data-periodo="1"></td>
                                    <td><input type="text" id="despesasFinanceiras_p2" name="despesasFinanceiras_p2" class="input-valor" data-conta="despesasFinanceiras" data-periodo="2"></td>
                                    <td><input type="text" id="despesasFinanceiras_p3" name="despesasFinanceiras_p3" class="input-valor" data-conta="despesasFinanceiras" data-periodo="3"></td>
                                    <td><input type="text" id="despesasFinanceiras_p4" name="despesasFinanceiras_p4" class="input-valor" data-conta="despesasFinanceiras" data-periodo="4"></td>
                                </tr>
                                <tr class="subtotal-row">
                                    <td>Resultado Financeiro L√≠quido</td>
                                    <td class="subtotal-valor" data-total="resultadoFinanceiroLiquido" data-periodo="1">R$ 0,00</td>
                                    <td class="subtotal-valor" data-total="resultadoFinanceiroLiquido" data-periodo="2">R$ 0,00</td>
                                    <td class="subtotal-valor" data-total="resultadoFinanceiroLiquido" data-periodo="3">R$ 0,00</td>
                                    <td class="subtotal-valor" data-total="resultadoFinanceiroLiquido" data-periodo="4">R$ 0,00</td>
                                </tr>

                                <!-- GRUPO: OUTRAS RECEITAS/DESPESAS -->
                                <tr class="grupo-header">
                                    <td colspan="5"><strong>OUTRAS RECEITAS/DESPESAS</strong></td>
                                </tr>
                                <tr class="conta-row">
                                    <td>(+) Outras Receitas N√£o-Operacionais</td>
                                    <td><input type="text" id="receitasNaoOperacionais_p1" name="receitasNaoOperacionais_p1" class="input-valor" data-conta="receitasNaoOperacionais" data-periodo="1"></td>
                                    <td><input type="text" id="receitasNaoOperacionais_p2" name="receitasNaoOperacionais_p2" class="input-valor" data-conta="receitasNaoOperacionais" data-periodo="2"></td>
                                    <td><input type="text" id="receitasNaoOperacionais_p3" name="receitasNaoOperacionais_p3" class="input-valor" data-conta="receitasNaoOperacionais" data-periodo="3"></td>
                                    <td><input type="text" id="receitasNaoOperacionais_p4" name="receitasNaoOperacionais_p4" class="input-valor" data-conta="receitasNaoOperacionais" data-periodo="4"></td>
                                </tr>
                                <tr class="conta-row negative-account last-in-group">
                                    <td>(-) Outras Despesas N√£o-Operacionais</td>
                                    <td><input type="text" id="despesasNaoOperacionais_p1" name="despesasNaoOperacionais_p1" class="input-valor" data-conta="despesasNaoOperacionais" data-periodo="1"></td>
                                    <td><input type="text" id="despesasNaoOperacionais_p2" name="despesasNaoOperacionais_p2" class="input-valor" data-conta="despesasNaoOperacionais" data-periodo="2"></td>
                                    <td><input type="text" id="despesasNaoOperacionais_p3" name="despesasNaoOperacionais_p3" class="input-valor" data-conta="despesasNaoOperacionais" data-periodo="3"></td>
                                    <td><input type="text" id="despesasNaoOperacionais_p4" name="despesasNaoOperacionais_p4" class="input-valor" data-conta="despesasNaoOperacionais" data-periodo="4"></td>
                                </tr>
                                <tr class="subtotal-row">
                                    <td>Outras Receitas/Despesas L√≠quidas</td>
                                    <td class="subtotal-valor" data-total="outrasReceitasDespesasLiquido" data-periodo="1">R$ 0,00</td>
                                    <td class="subtotal-valor" data-total="outrasReceitasDespesasLiquido" data-periodo="2">R$ 0,00</td>
                                    <td class="subtotal-valor" data-total="outrasReceitasDespesasLiquido" data-periodo="3">R$ 0,00</td>
                                    <td class="subtotal-valor" data-total="outrasReceitasDespesasLiquido" data-periodo="4">R$ 0,00</td>
                                </tr>

                                <!-- TOTAL: LAIR -->
                                <tr class="total-row">
                                    <td>LAIR (Lucro Antes do IR)</td>
                                    <td class="total-valor" data-total="lair" data-periodo="1">R$ 0,00</td>
                                    <td class="total-valor" data-total="lair" data-periodo="2">R$ 0,00</td>
                                    <td class="total-valor" data-total="lair" data-periodo="3">R$ 0,00</td>
                                    <td class="total-valor" data-total="lair" data-periodo="4">R$ 0,00</td>
                                </tr>

                                <!-- GRUPO: IMPOSTOS SOBRE LUCRO -->
                                <tr class="grupo-header">
                                    <td colspan="5"><strong>IMPOSTOS SOBRE LUCRO</strong></td>
                                </tr>
                                <tr class="conta-row negative-account">
                                    <td>(-) IRPJ</td>
                                    <td><input type="text" id="ir_p1" name="ir_p1" class="input-valor" data-conta="ir" data-periodo="1"></td>
                                    <td><input type="text" id="ir_p2" name="ir_p2" class="input-valor" data-conta="ir" data-periodo="2"></td>
                                    <td><input type="text" id="ir_p3" name="ir_p3" class="input-valor" data-conta="ir" data-periodo="3"></td>
                                    <td><input type="text" id="ir_p4" name="ir_p4" class="input-valor" data-conta="ir" data-periodo="4"></td>
                                </tr>
                                <tr class="conta-row negative-account last-in-group">
                                    <td>(-) CSLL</td>
                                    <td><input type="text" id="csll_p1" name="csll_p1" class="input-valor" data-conta="csll" data-periodo="1"></td>
                                    <td><input type="text" id="csll_p2" name="csll_p2" class="input-valor" data-conta="csll" data-periodo="2"></td>
                                    <td><input type="text" id="csll_p3" name="csll_p3" class="input-valor" data-conta="csll" data-periodo="3"></td>
                                    <td><input type="text" id="csll_p4" name="csll_p4" class="input-valor" data-conta="csll" data-periodo="4"></td>
                                </tr>
                                <tr class="subtotal-row">
                                    <td>Total Impostos sobre Lucro</td>
                                    <td class="subtotal-valor" data-total="impostosSobreLucroTotal" data-periodo="1">R$ 0,00</td>
                                    <td class="subtotal-valor" data-total="impostosSobreLucroTotal" data-periodo="2">R$ 0,00</td>
                                    <td class="subtotal-valor" data-total="impostosSobreLucroTotal" data-periodo="3">R$ 0,00</td>
                                    <td class="subtotal-valor" data-total="impostosSobreLucroTotal" data-periodo="4">R$ 0,00</td>
                                </tr>

                                <!-- TOTAL FINAL: LUCRO L√çQUIDO -->
                                <tr class="total-row">
                                    <td>LUCRO L√çQUIDO DO EXERC√çCIO</td>
                                    <td class="total-valor" data-total="lucroLiquido" data-periodo="1">R$ 0,00</td>
                                    <td class="total-valor" data-total="lucroLiquido" data-periodo="2">R$ 0,00</td>
                                    <td class="total-valor" data-total="lucroLiquido" data-periodo="3">R$ 0,00</td>
                                    <td class="total-valor" data-total="lucroLiquido" data-periodo="4">R$ 0,00</td>
                                </tr>
                                <tr class="subtotal-row">
                                    <td>Margem L√≠quida (%)</td>
                                    <td class="subtotal-valor" data-total="margemLiquida" data-periodo="1">0,00%</td>
                                    <td class="subtotal-valor" data-total="margemLiquida" data-periodo="2">0,00%</td>
                                    <td class="subtotal-valor" data-total="margemLiquida" data-periodo="3">0,00%</td>
                                    <td class="subtotal-valor" data-total="margemLiquida" data-periodo="4">0,00%</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    </div>

                    <!-- ========================================= -->
                    <!-- SE√á√ÉO 3: AN√ÅLISE DE ENDIVIDAMENTO -->
                    <!-- ========================================= -->
                    <!-- ========================================= -->
                    <!-- SE√á√ÉO 3: AN√ÅLISE DE ENDIVIDAMENTO -->
                    <!-- ========================================= -->
                    <div class="form-section" data-module="endividamento" id="section-3" role="tabpanel">
                        <div class="section-header">
                            <h2 class="section-title">üí≥ An√°lise de Endividamento</h2>
                            <p class="section-description">Detalhamento de d√≠vidas banc√°rias e outras obriga√ß√µes financeiras</p>
                        </div>

                        <!-- Bot√£o Adicionar D√≠vida + Contador -->
                        <div style="margin-bottom: 1.5rem; display: flex; justify-content: space-between; align-items: center;">
                            <button type="button" id="addDividaBtn" class="btn btn-primary">
                                ‚ûï Adicionar D√≠vida
                            </button>
                            <span id="totalDividas" style="color: #666; font-size: 0.9rem;">
                                Total de d√≠vidas cadastradas: <strong>0</strong>
                            </span>
                        </div>

                        <!-- Tabela de D√≠vidas -->
                        <div class="endividamento-container" style="overflow-x: auto; margin-bottom: 2rem;">
                            <table class="endividamento-table" style="width: 100%; border-collapse: collapse; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                                <thead>
                                    <tr style="background: #091A30; color: white;">
                                        <th style="padding: 12px; text-align: left; min-width: 180px; font-size: 0.85rem; text-transform: uppercase;">Institui√ß√£o Financeira</th>
                                        <th style="padding: 12px; text-align: left; min-width: 150px; font-size: 0.85rem; text-transform: uppercase;">Tipo de D√≠vida</th>
                                        <th style="padding: 12px; text-align: right; min-width: 130px; font-size: 0.85rem; text-transform: uppercase;">Valor Original (R$)</th>
                                        <th style="padding: 12px; text-align: right; min-width: 130px; font-size: 0.85rem; text-transform: uppercase;">Saldo Devedor (R$)</th>
                                        <th style="padding: 12px; text-align: center; min-width: 100px; font-size: 0.85rem; text-transform: uppercase;">Taxa Juros (%)</th>
                                        <th style="padding: 12px; text-align: center; min-width: 120px; font-size: 0.85rem; text-transform: uppercase;">Vencimento</th>
                                        <th style="padding: 12px; text-align: center; min-width: 120px; font-size: 0.85rem; text-transform: uppercase;">Status</th>
                                        <th style="padding: 12px; text-align: left; min-width: 150px; font-size: 0.85rem; text-transform: uppercase;">Garantias</th>
                                        <th style="padding: 12px; text-align: center; min-width: 80px; font-size: 0.85rem; text-transform: uppercase;">A√ß√µes</th>
                                    </tr>
                                </thead>
                                <tbody id="dividasTableBody">
                                    <!-- Empty State -->
                                    <tr id="emptyState">
                                        <td colspan="9" style="padding: 3rem; text-align: center; color: #999;">
                                            Nenhuma d√≠vida cadastrada. Clique em "Adicionar D√≠vida" para come√ßar.
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>

                        <!-- Resumo Consolidado -->
                        <div class="resumo-endividamento" style="margin-top: 2rem; display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1.5rem;">
                            <div class="card-metrica" style="background: #f8f9fa; padding: 1.5rem; border-radius: 8px; border-left: 4px solid #FF002D;">
                                <h4 style="color: #666; font-size: 0.85rem; margin-bottom: 0.5rem; font-weight: 600;">D√çVIDA TOTAL</h4>
                                <span id="dividaTotal" class="valor-destaque" style="font-size: 1.8rem; font-weight: 700; color: #091A30;">R$ 0,00</span>
                            </div>
                            <div class="card-metrica" style="background: #f8f9fa; padding: 1.5rem; border-radius: 8px; border-left: 4px solid #FF9800;">
                                <h4 style="color: #666; font-size: 0.85rem; margin-bottom: 0.5rem; font-weight: 600;">CURTO PRAZO (&lt; 12 meses)</h4>
                                <span id="dividaCurtoPrazo" style="font-size: 1.5rem; font-weight: 600; color: #091A30;">R$ 0,00</span>
                                <small id="percentualCP" style="color: #666; display: block; margin-top: 0.5rem;">0%</small>
                            </div>
                            <div class="card-metrica" style="background: #f8f9fa; padding: 1.5rem; border-radius: 8px; border-left: 4px solid #4CAF50;">
                                <h4 style="color: #666; font-size: 0.85rem; margin-bottom: 0.5rem; font-weight: 600;">LONGO PRAZO (&gt; 12 meses)</h4>
                                <span id="dividaLongoPrazo" style="font-size: 1.5rem; font-weight: 600; color: #091A30;">R$ 0,00</span>
                                <small id="percentualLP" style="color: #666; display: block; margin-top: 0.5rem;">0%</small>
                            </div>
                            <div class="card-metrica" style="background: #f8f9fa; padding: 1.5rem; border-radius: 8px; border-left: 4px solid #2196F3;">
                                <h4 style="color: #666; font-size: 0.85rem; margin-bottom: 0.5rem; font-weight: 600;">N√öMERO DE D√çVIDAS</h4>
                                <span id="numeroDividas" style="font-size: 1.5rem; font-weight: 600; color: #091A30;">0</span>
                                <small id="statusGeral" style="color: #666; display: block; margin-top: 0.5rem;">-</small>
                            </div>
                        </div>

                        <!-- √çndices Calculados -->
                        <div id="indicesEndividamentoSection" style="margin-top: 2rem; display: none;">
                            <h3 style="color: #091A30; font-size: 1.2rem; margin-bottom: 1rem; font-weight: 600;">
                                üìä √çndices de Endividamento Calculados
                            </h3>

                            <!-- Container de Alertas -->
                            <div id="alertasEndividamento" style="margin-bottom: 1.5rem;">
                                <!-- Alertas ser√£o inseridos aqui dinamicamente -->
                            </div>

                            <!-- Tabela de √çndices -->
                            <div style="overflow-x: auto;">
                                <table class="tabela-indices" style="width: 100%; border-collapse: collapse; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                                    <thead>
                                        <tr style="background: #f8f9fa; border-bottom: 2px solid #ddd;">
                                            <th style="padding: 12px; text-align: left; font-weight: 600; color: #091A30;">√çndice</th>
                                            <th style="padding: 12px; text-align: center; font-weight: 600; color: #091A30;">Valor</th>
                                            <th style="padding: 12px; text-align: center; font-weight: 600; color: #091A30;">Status</th>
                                            <th style="padding: 12px; text-align: left; font-weight: 600; color: #091A30;">Interpreta√ß√£o</th>
                                        </tr>
                                    </thead>
                                    <tbody id="indicesEndividamentoTableBody">
                                        <!-- Linhas ser√£o inseridas dinamicamente -->
                                    </tbody>
                                </table>
                            </div>

                            <p style="margin-top: 1rem; font-size: 0.85rem; color: #666;">
                                * √çndices calculados automaticamente com base no Balan√ßo Patrimonial (M√≥dulo 2) e nas d√≠vidas cadastradas.
                            </p>
                        </div>

                        <!-- Inadimpl√™ncia Hist√≥rica (> 90 dias) -->
                        <div class="inadimplencia-section">
                            <h3 class="subsection-title">‚è±Ô∏è Inadimpl√™ncia Hist√≥rica (> 90 dias)</h3>
                            <p class="subsection-description">An√°lise de atrasos superiores a 90 dias em contas a pagar e receber</p>

                            <div class="form-grid">
                                <!-- Contas a Pagar -->
                                <div class="form-group-card">
                                    <h4 class="card-title">üì§ Contas a Pagar</h4>

                                    <div class="form-group">
                                        <label for="contasPagarTotal">Total de Contas a Pagar (R$)</label>
                                        <input type="text" id="contasPagarTotal" name="contasPagarTotal" data-mask="currency">
                                    </div>

                                    <div class="form-group">
                                        <label for="contasPagar90Dias">Contas a Pagar > 90 dias (R$)</label>
                                        <input type="text" id="contasPagar90Dias" name="contasPagar90Dias" data-mask="currency">
                                    </div>

                                    <div class="indicador-box">
                                        <span class="indicador-label">Percentual de Inadimpl√™ncia:</span>
                                        <span id="inadimplenciaFornecedoresPerc" class="indicador-value">-</span>
                                    </div>
                                </div>

                                <!-- Contas a Receber -->
                                <div class="form-group-card">
                                    <h4 class="card-title">üì• Contas a Receber</h4>

                                    <div class="form-group">
                                        <label for="contasReceberTotal">Total de Contas a Receber (R$)</label>
                                        <input type="text" id="contasReceberTotal" name="contasReceberTotal" data-mask="currency">
                                    </div>

                                    <div class="form-group">
                                        <label for="contasReceber90Dias">Contas a Receber > 90 dias (R$)</label>
                                        <input type="text" id="contasReceber90Dias" name="contasReceber90Dias" data-mask="currency">
                                    </div>

                                    <div class="indicador-box">
                                        <span class="indicador-label">Percentual de Inadimpl√™ncia:</span>
                                        <span id="inadimplenciaClientesPerc" class="indicador-value">-</span>
                                    </div>
                                </div>
                            </div>

                            <!-- Alertas de Inadimpl√™ncia -->
                            <div id="alertasInadimplencia" class="alertas-container">
                                <!-- Alertas inseridos dinamicamente -->
                            </div>
                        </div>

                        <!-- Concentra√ß√£o de Risco -->
                        <div class="concentracao-section">
                            <h3 class="subsection-title">üéØ Concentra√ß√£o de Risco</h3>
                            <p class="subsection-description">An√°lise da depend√™ncia de principais clientes e fornecedores</p>

                            <!-- Top 5 Clientes -->
                            <div class="concentracao-clientes-container">
                                <h4 class="group-title">üë• Top 5 Clientes</h4>

                                <div class="clientes-list" id="clientesList">
                                    <div class="cliente-item">
                                        <div class="form-group">
                                            <label>Nome do Cliente</label>
                                            <input type="text" name="cliente_nome_1" class="cliente-nome">
                                        </div>
                                        <div class="form-group">
                                            <label>Receita Anual (R$)</label>
                                            <input type="text" name="cliente_receita_1" class="cliente-receita" data-mask="currency">
                                        </div>
                                        <div class="form-group">
                                            <label>% do Faturamento</label>
                                            <span class="cliente-percentual" data-index="1">-</span>
                                        </div>
                                    </div>

                                    <div class="cliente-item">
                                        <div class="form-group">
                                            <label>Nome do Cliente</label>
                                            <input type="text" name="cliente_nome_2" class="cliente-nome">
                                        </div>
                                        <div class="form-group">
                                            <label>Receita Anual (R$)</label>
                                            <input type="text" name="cliente_receita_2" class="cliente-receita" data-mask="currency">
                                        </div>
                                        <div class="form-group">
                                            <label>% do Faturamento</label>
                                            <span class="cliente-percentual" data-index="2">-</span>
                                        </div>
                                    </div>

                                    <div class="cliente-item">
                                        <div class="form-group">
                                            <label>Nome do Cliente</label>
                                            <input type="text" name="cliente_nome_3" class="cliente-nome">
                                        </div>
                                        <div class="form-group">
                                            <label>Receita Anual (R$)</label>
                                            <input type="text" name="cliente_receita_3" class="cliente-receita" data-mask="currency">
                                        </div>
                                        <div class="form-group">
                                            <label>% do Faturamento</label>
                                            <span class="cliente-percentual" data-index="3">-</span>
                                        </div>
                                    </div>

                                    <div class="cliente-item">
                                        <div class="form-group">
                                            <label>Nome do Cliente</label>
                                            <input type="text" name="cliente_nome_4" class="cliente-nome">
                                        </div>
                                        <div class="form-group">
                                            <label>Receita Anual (R$)</label>
                                            <input type="text" name="cliente_receita_4" class="cliente-receita" data-mask="currency">
                                        </div>
                                        <div class="form-group">
                                            <label>% do Faturamento</label>
                                            <span class="cliente-percentual" data-index="4">-</span>
                                        </div>
                                    </div>

                                    <div class="cliente-item">
                                        <div class="form-group">
                                            <label>Nome do Cliente</label>
                                            <input type="text" name="cliente_nome_5" class="cliente-nome">
                                        </div>
                                        <div class="form-group">
                                            <label>Receita Anual (R$)</label>
                                            <input type="text" name="cliente_receita_5" class="cliente-receita" data-mask="currency">
                                        </div>
                                        <div class="form-group">
                                            <label>% do Faturamento</label>
                                            <span class="cliente-percentual" data-index="5">-</span>
                                        </div>
                                    </div>
                                </div>

                                <div class="concentracao-resultado">
                                    <span class="resultado-label">Concentra√ß√£o Total (Top 5):</span>
                                    <span id="concentracaoClientesTotal" class="resultado-value">-</span>
                                </div>
                            </div>

                            <!-- Top 5 Fornecedores -->
                            <div class="concentracao-fornecedores-container">
                                <h4 class="group-title">üè≠ Top 5 Fornecedores</h4>

                                <div class="fornecedores-list" id="fornecedoresList">
                                    <div class="fornecedor-item">
                                        <div class="form-group">
                                            <label>Nome do Fornecedor</label>
                                            <input type="text" name="fornecedor_nome_1" class="fornecedor-nome">
                                        </div>
                                        <div class="form-group">
                                            <label>Compras Anuais (R$)</label>
                                            <input type="text" name="fornecedor_compras_1" class="fornecedor-compras" data-mask="currency">
                                        </div>
                                        <div class="form-group">
                                            <label>% das Compras</label>
                                            <span class="fornecedor-percentual" data-index="1">-</span>
                                        </div>
                                    </div>

                                    <div class="fornecedor-item">
                                        <div class="form-group">
                                            <label>Nome do Fornecedor</label>
                                            <input type="text" name="fornecedor_nome_2" class="fornecedor-nome">
                                        </div>
                                        <div class="form-group">
                                            <label>Compras Anuais (R$)</label>
                                            <input type="text" name="fornecedor_compras_2" class="fornecedor-compras" data-mask="currency">
                                        </div>
                                        <div class="form-group">
                                            <label>% das Compras</label>
                                            <span class="fornecedor-percentual" data-index="2">-</span>
                                        </div>
                                    </div>

                                    <div class="fornecedor-item">
                                        <div class="form-group">
                                            <label>Nome do Fornecedor</label>
                                            <input type="text" name="fornecedor_nome_3" class="fornecedor-nome">
                                        </div>
                                        <div class="form-group">
                                            <label>Compras Anuais (R$)</label>
                                            <input type="text" name="fornecedor_compras_3" class="fornecedor-compras" data-mask="currency">
                                        </div>
                                        <div class="form-group">
                                            <label>% das Compras</label>
                                            <span class="fornecedor-percentual" data-index="3">-</span>
                                        </div>
                                    </div>

                                    <div class="fornecedor-item">
                                        <div class="form-group">
                                            <label>Nome do Fornecedor</label>
                                            <input type="text" name="fornecedor_nome_4" class="fornecedor-nome">
                                        </div>
                                        <div class="form-group">
                                            <label>Compras Anuais (R$)</label>
                                            <input type="text" name="fornecedor_compras_4" class="fornecedor-compras" data-mask="currency">
                                        </div>
                                        <div class="form-group">
                                            <label>% das Compras</label>
                                            <span class="fornecedor-percentual" data-index="4">-</span>
                                        </div>
                                    </div>

                                    <div class="fornecedor-item">
                                        <div class="form-group">
                                            <label>Nome do Fornecedor</label>
                                            <input type="text" name="fornecedor_nome_5" class="fornecedor-nome">
                                        </div>
                                        <div class="form-group">
                                            <label>Compras Anuais (R$)</label>
                                            <input type="text" name="fornecedor_compras_5" class="fornecedor-compras" data-mask="currency">
                                        </div>
                                        <div class="form-group">
                                            <label>% das Compras</label>
                                            <span class="fornecedor-percentual" data-index="5">-</span>
                                        </div>
                                    </div>
                                </div>

                                <div class="concentracao-resultado">
                                    <span class="resultado-label">Concentra√ß√£o Total (Top 5):</span>
                                    <span id="concentracaoFornecedoresTotal" class="resultado-value">-</span>
                                </div>
                            </div>

                            <!-- Alertas de Concentra√ß√£o -->
                            <div id="alertasConcentracao" class="alertas-container">
                                <!-- Alertas inseridos dinamicamente -->
                            </div>
                        </div>
                    </div>

                    <!-- ========================================= -->
                    <!-- SE√á√ÉO 4: COMPLIANCE E VERIFICA√á√ïES -->
                    <!-- ========================================= -->
                    <div class="form-section" data-module="compliance" id="section-4" role="tabpanel">
                        <div class="section-header">
                            <h2 class="section-title">‚úÖ Compliance e Verifica√ß√µes</h2>
                            <p class="section-description">Certid√µes negativas, regularidade fiscal e situa√ß√£o jur√≠dica</p>
                        </div>

                        <div class="form-grid">
                            <div class="form-group">
                                <label>Certid√£o Negativa Federal *</label>
                                <div class="radio-group">
                                    <label><input type="radio" name="certidaoNegativaFederal" value="sim" required> Sim</label>
                                    <label><input type="radio" name="certidaoNegativaFederal" value="nao" required> N√£o</label>
                                </div>
                            </div>

                            <div class="form-group">
                                <label>Certid√£o Negativa Estadual *</label>
                                <div class="radio-group">
                                    <label><input type="radio" name="certidaoNegativaEstadual" value="sim" required> Sim</label>
                                    <label><input type="radio" name="certidaoNegativaEstadual" value="nao" required> N√£o</label>
                                </div>
                            </div>

                            <div class="form-group">
                                <label>Certid√£o Negativa Municipal *</label>
                                <div class="radio-group">
                                    <label><input type="radio" name="certidaoNegativaMunicipal" value="sim" required> Sim</label>
                                    <label><input type="radio" name="certidaoNegativaMunicipal" value="nao" required> N√£o</label>
                                </div>
                            </div>

                            <div class="form-group">
                                <label>FGTS Regular *</label>
                                <div class="radio-group">
                                    <label><input type="radio" name="fgtsRegular" value="sim" required> Sim</label>
                                    <label><input type="radio" name="fgtsRegular" value="nao" required> N√£o</label>
                                </div>
                            </div>

                            <div class="form-group">
                                <label>Protestos *</label>
                                <div class="radio-group">
                                    <label><input type="radio" name="protestos" value="sim" required> Sim</label>
                                    <label><input type="radio" name="protestos" value="nao" required> N√£o</label>
                                </div>
                            </div>

                            <div class="form-group">
                                <label for="processosJudiciais">N√∫mero de Processos Judiciais</label>
                                <input type="number" id="processosJudiciais" name="processosJudiciais" min="0" value="0">
                            </div>

                            <div class="form-group">
                                <label for="observacoesCompliance">Observa√ß√µes</label>
                                <textarea id="observacoesCompliance" name="observacoesCompliance" rows="4"></textarea>
                            </div>
                        </div>
                    </div>

                    <!-- ========================================= -->
                    <!-- SE√á√ÉO 5: RECURSOS HUMANOS -->
                    <!-- ========================================= -->
                    <div class="form-section" data-module="recursos-humanos" id="section-5" role="tabpanel">
                        <div class="section-header">
                            <h2 class="section-title">üë• Recursos Humanos</h2>
                            <p class="section-description">Estrutura de pessoal e folha de pagamento</p>
                        </div>

                        <div class="form-grid">
                            <div class="form-group">
                                <label for="totalFuncionarios">Total de Funcion√°rios *</label>
                                <input type="number" id="totalFuncionarios" name="totalFuncionarios" min="0" required>
                            </div>

                            <div class="form-group">
                                <label for="folhaPagamentoMensal">Folha de Pagamento Mensal (R$) *</label>
                                <input type="text" id="folhaPagamentoMensal" name="folhaPagamentoMensal" data-mask="currency" required>
                            </div>

                            <div class="form-group">
                                <label for="encargosSociais">Encargos Sociais Mensais (R$) *</label>
                                <input type="text" id="encargosSociais" name="encargosSociais" data-mask="currency" required>
                            </div>

                            <div class="form-group">
                                <label for="rotatividade">Taxa de Rotatividade (%)</label>
                                <input type="text" id="rotatividade" name="rotatividade" data-mask="percentage">
                            </div>

                            <div class="form-group">
                                <label for="observacoesRH">Observa√ß√µes</label>
                                <textarea id="observacoesRH" name="observacoesRH" rows="4"></textarea>
                            </div>
                        </div>
                    </div>

                    <!-- ========================================= -->
                    <!-- SE√á√ÉO 6: √çNDICES FINANCEIROS (Computado) -->
                    <!-- ========================================= -->
                    <div class="form-section" data-module="indices" id="section-6" role="tabpanel">
                        <div class="section-header">
                            <h2 class="section-title">üìà √çndices Financeiros</h2>
                            <p class="section-description">C√°lculo autom√°tico de √≠ndices de liquidez, rentabilidade e estrutura</p>
                        </div>
                        <div id="indicesContainer" class="results-container">
                            <p class="text-muted">Calculando √≠ndices financeiros...</p>
                        </div>
                    </div>

                    <!-- ========================================= -->
                    <!-- SE√á√ÉO 7: SCORING DE CR√âDITO (Computado) -->
                    <!-- ========================================= -->
                    <div class="form-section" data-module="scoring" id="section-7" role="tabpanel">
                        <div class="section-header">
                            <h2 class="section-title">‚≠ê Scoring de Cr√©dito</h2>
                            <p class="section-description">Classifica√ß√£o de risco baseada em an√°lise multifatorial</p>
                        </div>
                        <div id="scoringContainer" class="results-container">
                            <p class="text-muted">Calculando scoring de cr√©dito...</p>
                        </div>
                    </div>

                    <!-- ========================================= -->
                    <!-- SE√á√ÉO 8: RELAT√ìRIOS E AN√ÅLISES (Computado) -->
                    <!-- ========================================= -->
                    <div class="form-section" data-module="relatorios" id="section-8" role="tabpanel">
                        <div class="section-header">
                            <h2 class="section-title">üìÑ Relat√≥rios e An√°lises</h2>
                            <p class="section-description">Gera√ß√£o de relat√≥rios completos e exporta√ß√£o de dados</p>
                        </div>
                        <div id="relatoriosContainer" class="results-container">
                            <p class="text-muted">Carregando m√≥dulo de relat√≥rios...</p>
                        </div>
                    </div>

                </div>

                <!-- Form Actions -->
                <div class="form-actions" id="formActions" style="display: none;">
                    <div class="action-buttons">
                        <button type="button" class="btn btn-secondary" id="prevBtn" disabled>
                            ‚Üê Anterior
                        </button>
                        
                        <button type="button" class="btn btn-secondary" id="saveBtn">
                            üíæ Salvar Rascunho
                        </button>
                        
                        <button type="button" class="btn btn-primary" id="nextBtn">
                            Pr√≥ximo ‚Üí
                        </button>
                        
                        <button type="button" class="btn btn-success" id="finishBtn" style="display: none;">
                            ‚úì Finalizar An√°lise
                        </button>
                    </div>
                </div>
            </form>
        </div>
    </main>

    <!-- Alert Container -->
    <div class="alert-container" id="alertContainer"></div>

    <!-- Modal Container -->
    <div class="modal" id="modalContainer">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="modalTitle">T√≠tulo</h3>
                <button class="modal-close" id="modalClose">√ó</button>
            </div>
            <div class="modal-body" id="modalBody">
                <!-- Conte√∫do din√¢mico -->
            </div>
            <div class="modal-footer" id="modalFooter">
                <button class="btn btn-secondary" id="modalCancel">Cancelar</button>
                <button class="btn btn-primary" id="modalConfirm">Confirmar</button>
            </div>
        </div>
    </div>

    <!-- Save Status -->
    <div class="save-status" id="saveStatus">
        <span id="saveStatusText">üíæ Salvo</span>
    </div>

    <!-- Scripts Core -->
    <script type="module" src="../assets/js/utils/currency-mask.js"></script>
    <script type="module" src="../assets/js/utils/cnpj-validator.js"></script>
    <script type="module" src="../assets/js/utils/percentage-calculator.js"></script>

    <!-- UI Components -->
    <script type="module" src="../assets/js/components/ui-components.js"></script>

    <!-- Config Loader (deve vir antes do schema) -->
    <script type="module" src="../assets/js/core/config-loader.js"></script>

    <!-- Database Schema -->
    <script type="module" src="../assets/js/database/creditscore-indexeddb-schema.js"></script>
    <script type="module" src="../shared/validation.js"></script>
    <script type="module" src="../assets/js/export.js"></script>
    <script type="module" src="../assets/js/import.js"></script>
    <script type="module" src="../assets/js/tabs.js"></script>
    
    <!-- Scripts Calculators -->
    <script type="module" src="../assets/js/calculators/indices-financeiros.js"></script>
    <script type="module" src="../assets/js/calculators/scoring-engine.js"></script>
    <script type="module" src="../assets/js/calculators/analise-vertical-horizontal.js"></script>
    <script type="module" src="../assets/js/calculators/balanco-calculator.js"></script>
    <script type="module" src="../assets/js/calculators/capital-giro.js"></script>
    <script type="module" src="../assets/js/calculators/concentracao-risco.js"></script>
    <script type="module" src="../assets/js/components/concentracao-risco-integration.js"></script>

    <!-- Endividamento Module -->
    <script type="module" src="../assets/js/components/endividamento-manager.js"></script>
    <script type="module" src="../assets/js/calculators/endividamento-calculator.js"></script>
    <script type="module" src="../assets/js/components/endividamento-integration.js"></script>

    <!-- Scripts Core CreditScore -->
    <script type="module" src="../assets/js/core/message-loader.js"></script>
    <script type="module" src="../assets/js/core/calculation-state.js"></script>
    <script type="module" src="../assets/js/core/validation-engine.js"></script>
    <script type="module" src="../assets/js/core/calculation-orchestrator.js"></script>
    <script type="module" src="../assets/js/ui/calculation-indicators.js"></script>
    <script type="module" src="../assets/js/core/creditscore-module.js"></script>
    <script type="module" src="../assets/js/core/form-generator.js"></script>
    <script type="module" src="../assets/js/core/navigation-controller.js"></script>
    <script type="module" src="../assets/js/core/auto-save.js"></script>
    
    <!-- Main Application Script -->
    <script type="module">
        /**
         * CREDITSCORE PRO - MAIN APPLICATION
         * Sistema Modular de An√°lise de Cr√©dito
         * 
         * PRINC√çPIOS:
         * - KISS: Arquitetura simples e direta
         * - DRY: Componentes reutiliz√°veis
         * - SOLID: Separa√ß√£o de responsabilidades
         * - NO HARDCODED DATA: Tudo vem da configura√ß√£o
         * - NO MOCK DATA: Apenas dados reais do usu√°rio
         */
        
        class CreditScoreProApp {
            constructor() {
                this.config = null;
                this.messages = null;
                this.modules = new Map();
                this.currentModule = 1;
                this.formData = new Map();
                this.initialized = false;
                this.hierarchicalNav = null;
                this.dbManager = null;

                console.log('üöÄ CreditScore Pro App iniciando...');
            }
            
            /**
             * Inicializa√ß√£o principal da aplica√ß√£o
             *
             * ‚ö†Ô∏è ORDEM CR√çTICA DE EXECU√á√ÉO:
             *
             * 1. loadConfig()
             *    - Carrega config.json e messages.json via fetch
             *    - Exp√µe window.CONFIG e window.MESSAGES (global)
             *    - Atualiza t√≠tulo da p√°gina
             *
             * 2. checkDependencies()
             *    - Valida que todas as classes est√£o dispon√≠veis no window
             *    - Lista: ConfigLoader, FormGenerator, NavigationController,
             *             AutoSave, CreditScoreModule, HierarchicalNavigation,
             *             CreditscoreIndexedDB
             *
             * 3. initBasicModules()
             *    - ConfigLoader (sem depend√™ncias externas)
             *    - FormGenerator (depende de config + messages)
             *    - CreditScoreModule (depende de config + window.MESSAGES)
             *
             * 4. generateInterface()
             *    - Gera tabs HTML baseado em config.modules
             *    - Gera form content HTML usando FormGenerator
             *    - **CRIA .tab-item no DOM** (cr√≠tico para pr√≥ximo passo!)
             *    - Aplica m√°scaras currency
             *
             * 5. initNavigationAndDB()
             *    - HierarchicalNavigation (AGORA tabs existem no DOM!)
             *    - Nota: CreditscoreIndexedDB j√° inicializado por CreditScoreModule
             *
             * 6. initDependentModules()
             *    - NavigationController (depende de hierarchicalNav)
             *    - AutoSave (depende de dbManager)
             *
             * 7. setupNavigation() + setupAutoSave()
             *    - Configura event listeners para bot√µes
             *    - Ativa auto-save com intervalo configurado
             *
             * 8. attemptDataRestore()
             *    - Tenta restaurar dados salvos do IndexedDB
             *    - Confirma com usu√°rio se h√° dados
             *
             * 9. showInterface()
             *    - Esconde loading state
             *    - Mostra formul√°rio
             *    - Sistema pronto para uso
             *
             * ‚ö†Ô∏è N√ÉO ALTERAR ORDEM - Race conditions podem ocorrer!
             * Especialmente a ordem 4 ‚Üí 5 (gerar interface antes de HierarchicalNavigation)
             *
             * @returns {Promise<void>}
             * @throws {Error} Se inicializa√ß√£o falhar em qualquer etapa
             *
             * @see PHASE1-IMPLEMENTATION.md para detalhes completos
             * @see ARCHITECTURAL-ANALYSIS.md para an√°lise de depend√™ncias
             */
            /**
             * Inicializa√ß√£o principal usando Dependency Injection
             * ARQUITETURA: Two-Phase Init (Construction ‚Üí Initialization)
             *
             * ORDEM CR√çTICA (N√ÉO ALTERAR):
             *
             * FASE 1: Configura√ß√£o
             *   - loadConfig() ‚Üí window.CONFIG, window.MESSAGES
             *   - checkDependencies()
             *
             * FASE 2: Inst√¢ncias SEM DOM
             *   - ConfigLoader ‚Üí window.configLoader (global)
             *   - FormGenerator ‚Üí this.modules.get('formGenerator')
             *   - Database ‚Üí window.CreditscoreIndexedDB, dbManager proxy
             *
             * FASE 3: Gera√ß√£o do DOM
             *   - generateInterface() ‚Üí cria .tab-item no DOM
             *
             * FASE 4: Inst√¢ncias P√ìS-DOM
             *   - HierarchicalNavigation.initAfterDOM() ‚Üí this.hierarchicalNav
             *   - NavigationController ‚Üí injeta hierarchicalNav
             *   - AutoSave ‚Üí injeta navigationController
             *   - CreditScoreModule ‚Üí injeta TODAS as depend√™ncias
             *
             * FASE 5: Setup & Restore
             * FASE 6: Valida√ß√£o & Finaliza√ß√£o
             */
            async init() {
                try {
                    // ========================================
                    // FASE 1: CARREGAMENTO DE CONFIGURA√á√ÉO
                    // ========================================
                    await this.loadConfig();
                    // Exp√µe: window.CONFIG, window.MESSAGES

                    this.checkDependencies();
                    // Valida: window.HierarchicalNavigation, FormGenerator, etc. existem

                    // ========================================
                    // FASE 2: CRIA√á√ÉO DE INST√ÇNCIAS (SEM DOM)
                    // ========================================

                    // 2.1. ConfigLoader (PRIMEIRO - sem depend√™ncias)
                    const configLoader = new window.ConfigLoader(this.config);
                    await configLoader.init();
                    window.configLoader = configLoader; // Exp√µe globalmente (CreditscoreIndexedDB depende)
                    this.modules.set('config', configLoader);
                    console.log('‚úÖ ConfigLoader inicializado');

                    // 2.2. FormGenerator (precisa de config + messages)
                    const formGenerator = new window.FormGenerator(this.config, this.messages);
                    await formGenerator.init();
                    this.modules.set('formGenerator', formGenerator);
                    console.log('‚úÖ FormGenerator inicializado');

                    // 2.3. CreditscoreIndexedDB (precisa de window.configLoader validado)
                    await window.CreditscoreIndexedDB.openDatabase();
                    this.dbManager = this.#createDBManagerProxy();
                    console.log('‚úÖ Database inicializado');

                    // ========================================
                    // FASE 3: GERA√á√ÉO DO DOM
                    // ========================================
                    // AGORA FormGenerator existe em this.modules.get('formGenerator')
                    // await this.generateInterface(); // ‚ùå COMENTADO: HTML j√° hardcoded, tabs geradas por SimpleTabNavigation

                    // ========================================
                    // FASE 4: INICIALIZA√á√ÉO P√ìS-DOM
                    // ========================================

                    // 4.1. SimpleTabNavigation (8 m√≥dulos sequenciais)
                    this.hierarchicalNav = new window.SimpleTabNavigation();
                    await this.hierarchicalNav.init(); // ‚úÖ Inicializa sistema de navega√ß√£o
                    window.hierarchicalNavigation = this.hierarchicalNav;
                    console.log('‚úÖ SimpleTabNavigation inicializado');

                    // 4.2. NavigationController (precisa de hierarchicalNav)
                    const navigationController = new window.NavigationController(
                        this.config,
                        this.messages,
                        this.hierarchicalNav
                    );
                    await navigationController.init();
                    this.modules.set('navigation', navigationController);
                    console.log('‚úÖ NavigationController inicializado');
                    // üî¥ AutoSave temporariamente desabilitado para evitar loop de inicializa√ß√£o

                    // 4.4. CreditScoreModule (recebe depend√™ncias)
                    const creditScore = new window.CreditScoreModule(this.config);

                    // ‚úÖ INJETAR DEPEND√äNCIAS antes de init()
                    creditScore.hierarchicalNav = this.hierarchicalNav;
                    creditScore.navigationController = navigationController;
                    // creditScore.autoSave = autoSave; // üî¥ Desabilitado
                    creditScore.dbManager = this.dbManager;
                    creditScore.formGenerator = this.modules.get('formGenerator');
                    creditScore.scoringCriteria = this.scoringCriteria; // ‚úÖ Passa scoring criteria para ScoringEngine

                    // ‚úÖ INJETAR CALCULADORES CONFIGURADOS
                    // Criar e configurar o calculador de balan√ßos
                    const balancoCalculator = new window.CalculadorAnaliseBalancos();
                    await balancoCalculator.carregarConfig(); // Carrega /config/analise-balancos-config.json
                    creditScore.balancoCalculator = balancoCalculator;
                    console.log('‚úÖ BalancoCalculator configurado e injetado');

                    // Criar e configurar o gerenciador de endividamento
                    const endividamentoManager = new window.EndividamentoManager(this.config, this.messages, this.dbManager);
                    await endividamentoManager.init();
                    creditScore.endividamentoManager = endividamentoManager;
                    console.log('‚úÖ EndividamentoManager configurado e injetado');

                    await creditScore.init();
                    this.modules.set('creditScore', creditScore);
                    console.log('‚úÖ CreditScoreModule inicializado');

                    // Agora que creditScore existe, podemos inicializar o autoSave com ele
                    //await autoSave.init(creditScore, navigationController); // Passa o creditScoreModule
                    //console.log('‚úÖ AutoSave inicializado');

                     // üî¥ Inicializa√ß√£o do AutoSave desabilitada

                    // 4.5. EndividamentoIntegration (precisa de config, messages, dbManager)
                    if (window.EndividamentoIntegration) {
                        const endividamentoIntegration = new window.EndividamentoIntegration(
                            this.config,
                            this.messages,
                            this.dbManager
                        );
                        await endividamentoIntegration.init(null); // null = empresaId (ser√° definido quando empresa for selecionada)
                        this.modules.set('endividamento', endividamentoIntegration);
                        window.endividamentoIntegration = endividamentoIntegration; // Expor globalmente
                        console.log('‚úÖ EndividamentoIntegration inicializado');
                    } else {
                        console.warn('‚ö†Ô∏è EndividamentoIntegration n√£o dispon√≠vel');
                    }

                    // 4.5.1. ConcentracaoRiscoIntegration (precisa de config, messages, concentracaoCalculator)
                    if (window.ConcentracaoRiscoIntegration) {
                        const concentracaoRiscoIntegration = new window.ConcentracaoRiscoIntegration(
                            this.config,
                            this.messages,
                            creditScore.concentracaoCalculator
                        );
                        await concentracaoRiscoIntegration.init();
                        this.modules.set('concentracaoRisco', concentracaoRiscoIntegration);
                        window.concentracaoRiscoIntegration = concentracaoRiscoIntegration; // Expor globalmente
                        console.log('‚úÖ ConcentracaoRiscoIntegration inicializado');
                    } else {
                        console.warn('‚ö†Ô∏è ConcentracaoRiscoIntegration n√£o dispon√≠vel');
                    }

                    // ========================================
                    // FASE 4.5.2: REGISTRAR CALCULATORS NO ORCHESTRATOR
                    // ========================================
                    // Registra calculators para uso no fluxo autom√°tico de c√°lculo
                    // (acionado ao navegar para abas de resultado 6, 7, 8)

                    if (window.IndicesFinanceirosCalculator && window.calculationOrchestrator) {
                        const indicesCalc = new window.IndicesFinanceirosCalculator(this.config, this.messages);
                        window.calculationOrchestrator.registerCalculator('indices', indicesCalc);
                        console.log('‚úÖ IndicesFinanceirosCalculator registrado no orchestrator');
                    } else {
                        console.warn('‚ö†Ô∏è IndicesFinanceirosCalculator ou CalculationOrchestrator n√£o dispon√≠vel');
                    }

                    if (window.ScoringEngine && window.calculationOrchestrator) {
                        const scoringCalc = new window.ScoringEngine(this.config, this.messages);
                        window.calculationOrchestrator.registerCalculator('scoring', scoringCalc);
                        console.log('‚úÖ ScoringEngine registrado no orchestrator');
                    } else {
                        console.warn('‚ö†Ô∏è ScoringEngine ou CalculationOrchestrator n√£o dispon√≠vel');
                    }

                    // 4.6. ImportManager (precisa de config, creditScoreModule)
                    // DEVE ser inicializado AP√ìS CreditScoreModule
                    if (window.ImportManager) {
                        const importManager = new window.ImportManager(
                            this.config,
                            creditScore // Injeta o m√≥dulo principal
                        );
                        this.modules.set('importManager', importManager);
                        console.log('‚úÖ ImportManager inicializado e integrado');
                    } else {
                        console.warn('‚ö†Ô∏è ImportManager n√£o dispon√≠vel');
                    }

                    // ========================================
                    // FASE 5: SETUP
                    // ========================================
                    // this.setupNavigation(); // Movido para dentro do NavigationController

                    // ========================================
                    // FASE 6: VALIDA√á√ÉO & FINALIZA√á√ÉO
                    // ========================================
                    // Validar que m√≥dulos foram criados na ordem correta
                    this.#validateInitializationOrder();

                    this.initialized = true;
                    this.showInterface();

                    // ‚úÖ Configura o bot√£o de salvamento manual para chamar o CreditScoreModule diretamente
                    document.getElementById('saveBtn').addEventListener('click', () => creditScore.salvarRascunho());

                    console.log('‚úÖ CreditScore Pro inicializado com sucesso');

                    // ========================================
                    // FASE 7: RESTORE (ap√≥s interface vis√≠vel)
                    // ========================================
                    // Agora confirm() n√£o bloqueia a interface
                    // await this.attemptDataRestore(); // üî¥ Desabilitado pois depende do AutoSave

                } catch (error) {
                    console.error('‚ùå Erro na inicializa√ß√£o:', error);
                    this.showError('Erro ao inicializar o sistema', error.message);
                    
                    // Fallback: mostrar interface mesmo com erro
                    try {
                        this.showInterface();
                    } catch (showError) {
                        console.error('‚ùå Falha ao mostrar interface:', showError);
                        // √öltimo recurso: esconder loading
                        document.getElementById('loadingOverlay')?.remove();
                    }
                }
            }

            /**
             * Cria proxy object para CreditscoreIndexedDB (static methods ‚Üí instance-like)
             * @private
             */
#createDBManagerProxy() {
                return {
                    init: async () => window.CreditscoreIndexedDB.openDatabase(),
                    get: (storeName, key) => window.CreditscoreIndexedDB.get(storeName, key),
                    save: (storeName, data) => window.CreditscoreIndexedDB.save(storeName, data),
                    delete: (storeName, key) => window.CreditscoreIndexedDB.delete(storeName, key),
                    getAll: (storeName, indexName) => window.CreditscoreIndexedDB.getAll(storeName, indexName),
                    clear: (storeName) => window.CreditscoreIndexedDB.clear(storeName)
                };
            }

            /**
             * Valida ordem de inicializa√ß√£o
             * Garante que depend√™ncias foram criadas na ordem correta
             * @private
             * @throws {Error} Se ordem est√° incorreta
             */
            #validateInitializationOrder() {
                const requiredOrder = [
                    'config',        // 1. ConfigLoader
                    'formGenerator', // 2. FormGenerator
                    // (dbManager n√£o est√° em modules, √© this.dbManager)
                    // (generateInterface cria DOM)
                    // (hierarchicalNav n√£o est√° em modules, √© this.hierarchicalNav)
                    'navigation',    // 3. NavigationController
                    'creditScore'    // 5. CreditScoreModule
                ];

                const moduleKeys = Array.from(this.modules.keys());

                for (let i = 0; i < requiredOrder.length; i++) {
                    const expected = requiredOrder[i];

                    if (!this.modules.has(expected)) {
                        throw new Error(`Ordem de inicializa√ß√£o incorreta: m√≥dulo "${expected}" deveria estar em posi√ß√£o ${i + 1}, mas n√£o existe`);
                    }

                    // Verificar se existe antes dos esperados posteriormente
                    const position = moduleKeys.indexOf(expected);
                    for (let j = i + 1; j < requiredOrder.length; j++) {
                        const laterModule = requiredOrder[j];
                        const laterPosition = moduleKeys.indexOf(laterModule);

                        if (laterPosition !== -1 && laterPosition < position) {
                            throw new Error(`Ordem de inicializa√ß√£o incorreta: "${laterModule}" foi criado antes de "${expected}"`);
                        }
                    }
                }

                console.log('‚úÖ Ordem de inicializa√ß√£o validada');
            }

            /**
             * Carrega configura√ß√£o do sistema e messages
             */
            async loadConfig() {
                try {
                    // Carregar config, messages E scoring-criteria em paralelo (Performance)
                    const [configResponse, messagesResponse, scoringCriteriaResponse] = await Promise.all([
                        fetch('../../config/creditscore-config.json'),
                        fetch('../../config/messages.json'),
                        fetch('../../config/scoring-criteria.json')
                    ]);

                    if (!configResponse.ok) {
                        throw new Error(`Config: HTTP ${configResponse.status}: ${configResponse.statusText}`);
                    }
                    if (!messagesResponse.ok) {
                        throw new Error(`Messages: HTTP ${messagesResponse.status}: ${messagesResponse.statusText}`);
                    }
                    if (!scoringCriteriaResponse.ok) {
                        throw new Error(`Scoring Criteria: HTTP ${scoringCriteriaResponse.status}: ${scoringCriteriaResponse.statusText}`);
                    }

                    this.config = await configResponse.json();
                    this.messages = await messagesResponse.json();
                    this.scoringCriteria = await scoringCriteriaResponse.json();

                    // Expor como globais para compatibilidade com m√≥dulos legados
                    // TODO FASE 2: Remover ap√≥s migrar CreditScoreModule para Dependency Injection
                    window.CONFIG = this.config;
                    window.MESSAGES = this.messages;

                    // Atualizar t√≠tulo da p√°gina
                    document.title = `${this.config.systemName} | Expertzy`;
                    document.getElementById('systemTitle').textContent = this.config.systemName;
                    document.getElementById('systemSubtitle').textContent = this.config.description;

                    console.log('‚úÖ Configura√ß√£o carregada:', this.config.systemName, 'v' + this.config.version);
                    console.log('‚úÖ Messages carregado');
                    console.log('‚úÖ Scoring Criteria carregado');

                } catch (error) {
                    throw new Error(`Falha ao carregar configura√ß√£o: ${error.message}`);
                }
            }
            
            /**
             * Verifica depend√™ncias obrigat√≥rias
             */
            checkDependencies() {
                const requiredClasses = [
                    'ConfigLoader',
                    'FormGenerator',
                    'NavigationController',
                    'AutoSave',
                    'CreditScoreModule',
                    'SimpleTabNavigation',
                    'CreditscoreIndexedDB'
                ];

                const missing = requiredClasses.filter(cls => typeof window[cls] === 'undefined');

                if (missing.length > 0) {
                    throw new Error(`Depend√™ncias ausentes: ${missing.join(', ')}`);
                }

                console.log('‚úÖ Depend√™ncias verificadas');
            }
            
            // ============================================
            // M√âTODOS OBSOLETOS REMOVIDOS
            // ============================================
            // - initBasicModules() (substitu√≠do por fluxo √∫nico em init())
            // - initNavigationAndDB() (substitu√≠do por fluxo √∫nico em init())
            // - initDependentModules() (substitu√≠do por fluxo √∫nico em init())
            //
            // Raz√£o: Two-Phase Initialization pattern agora implementado
            // diretamente no m√©todo init() principal (linhas 254-329)
            // ============================================
            
            /**
             * Gera interface baseada na configura√ß√£o
             * Cria tabs e form content dinamicamente
             *
             * ‚ö†Ô∏è PR√â-REQUISITO: FormGenerator DEVE estar inicializado
             * Este m√©todo √© chamado na FASE 3 do init(), ap√≥s FormGenerator ser criado na FASE 2
             */
            async generateInterface() {
                const formGenerator = this.modules.get('formGenerator');

                // Valida√ß√£o cr√≠tica: FormGenerator DEVE existir
                if (!formGenerator) {
                    throw new Error('generateInterface: FormGenerator n√£o inicializado - DEVE ser criado antes de chamar este m√©todo');
                }

                // 1. Gerar tabs de navega√ß√£o
                const tabsHTML = this.config.modules.map(module => `
                    <div class="tab-item ${module.id === 1 ? 'active' : ''}" data-module="${module.id}">
                        <span class="tab-icon">${module.icon}</span>
                        <span class="tab-label">${module.title}</span>
                        ${module.computed ? '<span class="computed-badge">Auto</span>' : ''}
                    </div>
                `).join('');

                // Injetar tabs no DOM
                const tabNav = document.getElementById('tabNavigation');
                if (tabNav) {
                    tabNav.innerHTML = tabsHTML;
                }

                // 2. Gerar conte√∫do dos formul√°rios para cada m√≥dulo
                const formContentHTML = this.config.modules.map(module => {
                    try {
                        return formGenerator.generateModuleHTML(module.id);
                    } catch (error) {
                        console.error(`Erro ao gerar m√≥dulo ${module.id}:`, error);
                        return `<div class="module-content error-state" data-module="${module.id}" style="display:none;">
                            <h2>‚ö†Ô∏è Erro ao carregar m√≥dulo ${module.title}</h2>
                            <p>${error.message}</p>
                        </div>`;
                    }
                }).join('');

                // Injetar form content no DOM
                const formContent = document.getElementById('formContent');
                if (formContent) {
                    formContent.innerHTML = formContentHTML;
                }

                // 3. Ativar listeners de m√°scaras e valida√ß√£o
                if (window.currencyMask) {
                    window.currencyMask.init(); // ‚úÖ M√©todo correto: init() (n√£o applyToAll)
                }

                console.log('‚úÖ Interface gerada');
            }
            
            /**
             * Configura sistema de navega√ß√£o
             */
            setupNavigation() {
                const navigation = this.modules.get('navigation');

                // Event listeners para bot√µes de navega√ß√£o
                document.getElementById('nextBtn').addEventListener('click', () => {
                    // NavigationController.navigateToModule() j√° valida limites e depend√™ncias
                    const nextModuleId = navigation.currentModule + 1;
                    if (nextModuleId <= this.config.totalSteps) {
                        navigation.navigateToModule(nextModuleId);
                    }
                });

                document.getElementById('prevBtn').addEventListener('click', () => {
                    // Navega√ß√£o para tr√°s sempre permitida
                    const prevModuleId = navigation.currentModule - 1;
                    if (prevModuleId >= 1) {
                        navigation.navigateToModule(prevModuleId);
                    }
                });

                // Tab click handlers j√° configurados por HierarchicalNavigation.initAfterDOM()
                // N√£o √© necess√°rio chamar setupTabClickHandlers() aqui

                console.log('‚úÖ Navega√ß√£o configurada');
            }
            
            /**
             * Configura auto-save
             */
            setupAutoSave() {
                const autoSave = this.modules.get('autoSave');
                
                // Event listeners para mudan√ßas no formul√°rio
                document.getElementById('creditScoreForm').addEventListener('input', () => {
                    autoSave.scheduleAutoSave();
                });
                
                document.getElementById('creditScoreForm').addEventListener('change', () => {
                    autoSave.scheduleAutoSave();
                });
                
                // Event listener para salvar manual
                document.getElementById('saveBtn').addEventListener('click', () => {
                    autoSave.saveNow(); // ‚úÖ Chama saveNow() corretamente
                });
                
                // Event listener para antes de sair da p√°gina
                window.addEventListener('beforeunload', () => {
                    autoSave.saveNow();
                });
                
                console.log('‚úÖ Auto-save configurado');
            }
            
            /**
             * Tenta restaurar dados salvos
             */
            async attemptDataRestore() {
                const autoSave = this.modules.get('autoSave');
                
                try {
                    const savedData = await autoSave.loadSavedData();
                    
                    if (savedData && Object.keys(savedData).length > 0) {
                        const restore = confirm('Dados de uma sess√£o anterior foram encontrados. Deseja restaur√°-los?');
                        
                        if (restore) {
                            await this.restoreFormData(savedData);
                            this.showAlert('success', 'Dados restaurados com sucesso');
                        }
                    }
                } catch (error) {
                    console.log('‚ÑπÔ∏è Nenhum dado anterior encontrado');
                }
            }
            
            /**
             * Restaura dados no formul√°rio
             */
            async restoreFormData(data) {
                // Implementar restaura√ß√£o de dados
                // TODO: Implementar l√≥gica de restaura√ß√£o
                console.log('üì• Restaurando dados:', data);
            }
            
            /**
             * Mostra interface principal
             */
            showInterface() {
                document.getElementById('loadingState').style.display = 'none';
                document.getElementById('formContent').style.display = 'block';
                document.getElementById('formActions').style.display = 'block';
                document.getElementById('progressContainer').style.display = 'block';
                document.getElementById('tabNavigation').style.display = 'flex';
            }
            
            /**
             * Mostra erro para o usu√°rio
             */
            showError(title, message) {
                const errorHtml = `
                    <div class="alert alert-danger">
                        <h4>${title}</h4>
                        <p>${message}</p>
                        <button onclick="location.reload()" class="btn btn-primary mt-3">
                            Recarregar P√°gina
                        </button>
                    </div>
                `;
                
                document.getElementById('loadingState').innerHTML = errorHtml;
            }
            
            /**
             * Mostra alerta para o usu√°rio
             */
            showAlert(type, message) {
                const alertHtml = `
                    <div class="alert alert-${type} alert-dismissible">
                        ${message}
                        <button type="button" class="alert-close" onclick="this.parentElement.remove()">√ó</button>
                    </div>
                `;
                
                const container = document.getElementById('alertContainer');
                container.innerHTML = alertHtml;
                
                // Auto-remove ap√≥s 5 segundos
                setTimeout(() => {
                    const alert = container.querySelector('.alert');
                    if (alert) alert.remove();
                }, 5000);
            }
        }
        
        // Inicializar aplica√ß√£o quando DOM estiver pronto
        document.addEventListener('DOMContentLoaded', () => {
            window.creditScoreApp = new CreditScoreProApp();
            window.creditScoreApp.init();
        });
        
        // Prevenir perda de dados ao sair da p√°gina
        window.addEventListener('beforeunload', (e) => {
            if (window.creditScoreApp && window.creditScoreApp.initialized) {
                e.preventDefault();
                e.returnValue = 'Voc√™ tem altera√ß√µes n√£o salvas. Deseja realmente sair?';
                return e.returnValue;
            }
        });
    </script>
</body>
</html>